(()=>{var e={651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSession=t.ErrorDestination=t.MemoryEvent=t.InvalidatedEvent=t.ProgressEndEvent=t.ProgressUpdateEvent=t.ProgressStartEvent=t.CapabilitiesEvent=t.LoadedSourceEvent=t.ModuleEvent=t.BreakpointEvent=t.ThreadEvent=t.OutputEvent=t.ExitedEvent=t.TerminatedEvent=t.InitializedEvent=t.ContinuedEvent=t.StoppedEvent=t.CompletionItem=t.Module=t.Breakpoint=t.Variable=t.Thread=t.StackFrame=t.Scope=t.Source=void 0;const i=n(839),s=n(601),o=n(153),r=n(310);t.Source=class{constructor(e,t,n=0,i,s){this.name=e,this.path=t,this.sourceReference=n,i&&(this.origin=i),s&&(this.adapterData=s)}},t.Scope=class{constructor(e,t,n=!1){this.name=e,this.variablesReference=t,this.expensive=n}},t.StackFrame=class{constructor(e,t,n,i=0,s=0){this.id=e,this.source=n,this.line=i,this.column=s,this.name=t}},t.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}},t.Variable=class{constructor(e,t,n=0,i,s){this.name=e,this.value=t,this.variablesReference=n,"number"==typeof s&&(this.namedVariables=s),"number"==typeof i&&(this.indexedVariables=i)}},t.Breakpoint=class{constructor(e,t,n,i){this.verified=e;const s=this;"number"==typeof t&&(s.line=t),"number"==typeof n&&(s.column=n),i&&(s.source=i)}setId(e){this.id=e}},t.Module=class{constructor(e,t){this.id=e,this.name=t}},t.CompletionItem=class{constructor(e,t,n=0){this.label=e,this.start=t,this.length=n}};class a extends s.Event{constructor(e,t,n){super("stopped"),this.body={reason:e},"number"==typeof t&&(this.body.threadId=t),"string"==typeof n&&(this.body.text=n)}}t.StoppedEvent=a;class p extends s.Event{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}}t.ContinuedEvent=p;class c extends s.Event{constructor(){super("initialized")}}t.InitializedEvent=c;class l extends s.Event{constructor(e){super("terminated"),("boolean"==typeof e||e)&&(this.body={restart:e})}}t.TerminatedEvent=l;class u extends s.Event{constructor(e){super("exited"),this.body={exitCode:e}}}t.ExitedEvent=u;class h extends s.Event{constructor(e,t="console",n){super("output"),this.body={category:t,output:e},void 0!==n&&(this.body.data=n)}}t.OutputEvent=h;class d extends s.Event{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}}t.ThreadEvent=d;class m extends s.Event{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}}t.BreakpointEvent=m;class g extends s.Event{constructor(e,t){super("module"),this.body={reason:e,module:t}}}t.ModuleEvent=g;class b extends s.Event{constructor(e,t){super("loadedSource"),this.body={reason:e,source:t}}}t.LoadedSourceEvent=b;class f extends s.Event{constructor(e){super("capabilities"),this.body={capabilities:e}}}t.CapabilitiesEvent=f;class E extends s.Event{constructor(e,t,n){super("progressStart"),this.body={progressId:e,title:t},"string"==typeof n&&(this.body.message=n)}}t.ProgressStartEvent=E;class v extends s.Event{constructor(e,t){super("progressUpdate"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}t.ProgressUpdateEvent=v;class T extends s.Event{constructor(e,t){super("progressEnd"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}t.ProgressEndEvent=T;class y extends s.Event{constructor(e,t,n){super("invalidated"),this.body={},e&&(this.body.areas=e),t&&(this.body.threadId=t),n&&(this.body.stackFrameId=n)}}t.InvalidatedEvent=y;class R extends s.Event{constructor(e,t,n){super("memory"),this.body={memoryReference:e,offset:t,count:n}}}var _;t.MemoryEvent=R,function(e){e[e.User=1]="User",e[e.Telemetry=2]="Telemetry"}(_=t.ErrorDestination||(t.ErrorDestination={}));class x extends i.ProtocolServer{constructor(e,t){super();const n="boolean"==typeof e&&e;this._debuggerLinesStartAt1=n,this._debuggerColumnsStartAt1=n,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer="boolean"==typeof t&&t,this.on("close",(()=>{this.shutdown()})),this.on("error",(e=>{this.shutdown()}))}setDebuggerPathFormat(e){this._debuggerPathsAreURIs="path"!==e}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){(0,o.runDebugAdapter)(e)}shutdown(){this._isServer||this._isRunningInline()||setTimeout((()=>{process.exit(0)}),100)}sendErrorResponse(e,t,n,i,s=_.User){let o;"number"==typeof t?(o={id:t,format:n},i&&(o.variables=i),s&_.User&&(o.showUser=!0),s&_.Telemetry&&(o.sendTelemetry=!0)):o=t,e.success=!1,e.message=x.formatPII(o.format,!0,o.variables),e.body||(e.body={}),e.body.error=o,this.sendResponse(e)}runInTerminalRequest(e,t,n){this.sendRequest("runInTerminal",e,t,n)}dispatchRequest(e){const t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,_.Telemetry);else{const e=t;e.body={},this.initializeRequest(e,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments,e):"attach"===e.command?this.attachRequest(t,e.arguments,e):"disconnect"===e.command?this.disconnectRequest(t,e.arguments,e):"terminate"===e.command?this.terminateRequest(t,e.arguments,e):"restart"===e.command?this.restartRequest(t,e.arguments,e):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments,e):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments,e):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments,e):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments,e):"continue"===e.command?this.continueRequest(t,e.arguments,e):"next"===e.command?this.nextRequest(t,e.arguments,e):"stepIn"===e.command?this.stepInRequest(t,e.arguments,e):"stepOut"===e.command?this.stepOutRequest(t,e.arguments,e):"stepBack"===e.command?this.stepBackRequest(t,e.arguments,e):"reverseContinue"===e.command?this.reverseContinueRequest(t,e.arguments,e):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments,e):"goto"===e.command?this.gotoRequest(t,e.arguments,e):"pause"===e.command?this.pauseRequest(t,e.arguments,e):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments,e):"scopes"===e.command?this.scopesRequest(t,e.arguments,e):"variables"===e.command?this.variablesRequest(t,e.arguments,e):"setVariable"===e.command?this.setVariableRequest(t,e.arguments,e):"setExpression"===e.command?this.setExpressionRequest(t,e.arguments,e):"source"===e.command?this.sourceRequest(t,e.arguments,e):"threads"===e.command?this.threadsRequest(t,e):"terminateThreads"===e.command?this.terminateThreadsRequest(t,e.arguments,e):"evaluate"===e.command?this.evaluateRequest(t,e.arguments,e):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments,e):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments,e):"completions"===e.command?this.completionsRequest(t,e.arguments,e):"exceptionInfo"===e.command?this.exceptionInfoRequest(t,e.arguments,e):"loadedSources"===e.command?this.loadedSourcesRequest(t,e.arguments,e):"dataBreakpointInfo"===e.command?this.dataBreakpointInfoRequest(t,e.arguments,e):"setDataBreakpoints"===e.command?this.setDataBreakpointsRequest(t,e.arguments,e):"readMemory"===e.command?this.readMemoryRequest(t,e.arguments,e):"writeMemory"===e.command?this.writeMemoryRequest(t,e.arguments,e):"disassemble"===e.command?this.disassembleRequest(t,e.arguments,e):"cancel"===e.command?this.cancelRequest(t,e.arguments,e):"breakpointLocations"===e.command?this.breakpointLocationsRequest(t,e.arguments,e):"setInstructionBreakpoints"===e.command?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack},_.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsExceptionFilterOptions=!1,this.sendResponse(e)}disconnectRequest(e,t,n){this.sendResponse(e),this.shutdown()}launchRequest(e,t,n){this.sendResponse(e)}attachRequest(e,t,n){this.sendResponse(e)}terminateRequest(e,t,n){this.sendResponse(e)}restartRequest(e,t,n){this.sendResponse(e)}setBreakPointsRequest(e,t,n){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,n){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,n){this.sendResponse(e)}configurationDoneRequest(e,t,n){this.sendResponse(e)}continueRequest(e,t,n){this.sendResponse(e)}nextRequest(e,t,n){this.sendResponse(e)}stepInRequest(e,t,n){this.sendResponse(e)}stepOutRequest(e,t,n){this.sendResponse(e)}stepBackRequest(e,t,n){this.sendResponse(e)}reverseContinueRequest(e,t,n){this.sendResponse(e)}restartFrameRequest(e,t,n){this.sendResponse(e)}gotoRequest(e,t,n){this.sendResponse(e)}pauseRequest(e,t,n){this.sendResponse(e)}sourceRequest(e,t,n){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,n){this.sendResponse(e)}stackTraceRequest(e,t,n){this.sendResponse(e)}scopesRequest(e,t,n){this.sendResponse(e)}variablesRequest(e,t,n){this.sendResponse(e)}setVariableRequest(e,t,n){this.sendResponse(e)}setExpressionRequest(e,t,n){this.sendResponse(e)}evaluateRequest(e,t,n){this.sendResponse(e)}stepInTargetsRequest(e,t,n){this.sendResponse(e)}gotoTargetsRequest(e,t,n){this.sendResponse(e)}completionsRequest(e,t,n){this.sendResponse(e)}exceptionInfoRequest(e,t,n){this.sendResponse(e)}loadedSourcesRequest(e,t,n){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,n){this.sendResponse(e)}setDataBreakpointsRequest(e,t,n){this.sendResponse(e)}readMemoryRequest(e,t,n){this.sendResponse(e)}writeMemoryRequest(e,t,n){this.sendResponse(e)}disassembleRequest(e,t,n){this.sendResponse(e)}cancelRequest(e,t,n){this.sendResponse(e)}breakpointLocationsRequest(e,t,n){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,n){this.sendResponse(e)}customRequest(e,t,n,i){this.sendErrorResponse(t,1014,"unrecognized request",null,_.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?x.uri2path(e):x.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?x.uri2path(e):x.path2uri(e):e}static path2uri(e){"win32"===process.platform&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new r.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new r.URL(e),n=decodeURIComponent(t.pathname);return"win32"===process.platform&&(/^\/[a-zA-Z]:/.test(n)&&(n=n[1].toLowerCase()+n.substr(2)),n=n.replace(/\//g,"\\")),n}static formatPII(e,t,n){return e.replace(x._formatPIIRegexp,(function(e,i){return t&&i.length>0&&"_"!==i[0]?e:n[i]&&n.hasOwnProperty(i)?n[i]:e}))}}t.DebugSession=x,x._formatPIIRegexp=/{([^}]+)}/g},527:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Handles=void 0,t.Handles=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle="number"==typeof e?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}}},309:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalLogger=void 0;const i=n(147),s=n(17),o=n(100);function r(){let e=new Date;return a(2,String(e.getUTCHours()))+":"+a(2,String(e.getUTCMinutes()))+":"+a(2,String(e.getUTCSeconds()))+"."+a(3,String(e.getUTCMilliseconds()))+" UTC"}function a(e,t){return t.length>=e?t:String("0".repeat(e)+t).slice(-e)}t.InternalLogger=class{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=o.LogLevel.Warn,this.disposeCallback=(e,t)=>{this.dispose(),t=t||2,t+=128,process.exit(t)}}async setup(e){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(s.isAbsolute(e.logFilePath)){const t=t=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${t.toString()}\n`,o.LogLevel.Error);try{await i.promises.mkdir(s.dirname(e.logFilePath),{recursive:!0}),this.log("Verbose logs are written to:\n",o.LogLevel.Warn),this.log(e.logFilePath+"\n",o.LogLevel.Warn),this._logFileStream=i.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",(e=>{t(e)}))}catch(e){t(e)}}else this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,o.LogLevel.Error)}logDateTime(){let e=new Date;const t=e.getUTCFullYear()+"-"+`${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+r();this.log(t+"\n",o.LogLevel.Verbose,!1)}setupShutdownListeners(){process.on("beforeExit",this.beforeExitCallback),process.on("SIGTERM",this.disposeCallback),process.on("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise((e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()}))}log(e,t,n=!0){if(this._minLogLevel!==o.LogLevel.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){const n=t===o.LogLevel.Error?console.error:t===o.LogLevel.Warn?console.warn:null;n&&n((0,o.trimLastNewline)(e))}t===o.LogLevel.Error&&(e=`[${o.LogLevel[t]}] ${e}`),this._prependTimestamp&&n&&(e="["+r()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){const t=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",t&&(e+="\n")}if(this._logCallback){const n=new o.LogOutputEvent(e,t);this._logCallback(n)}}}},100:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trimLastNewline=t.LogOutputEvent=t.logger=t.Logger=t.LogLevel=void 0;const i=n(309),s=n(651);var o;!function(e){e[e.Verbose=0]="Verbose",e[e.Log=1]="Log",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.Stop=4]="Stop"}(o=t.LogLevel||(t.LogLevel={}));class r{constructor(){this._pendingLogQ=[]}log(e,t=o.Log){e+="\n",this._write(e,t)}verbose(e){this.log(e,o.Verbose)}warn(e){this.log(e,o.Warn)}error(e){this.log(e,o.Error)}dispose(){if(this._currentLogger){const e=this._currentLogger.dispose();return this._currentLogger=null,e}return Promise.resolve()}_write(e,t=o.Log){e+="",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,n=!0){const i="string"==typeof t?t:t&&this._logFilePathFromInit;if(this._currentLogger){const t={consoleMinLogLevel:e,logFilePath:i,prependTimestamp:n};this._currentLogger.setup(t).then((()=>{if(this._pendingLogQ){const e=this._pendingLogQ;this._pendingLogQ=null,e.forEach((e=>this._write(e.msg,e.level)))}}))}}init(e,t,n){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new i.InternalLogger(e,n),this._logFilePathFromInit=t}}t.Logger=r,t.logger=new r;class a extends s.OutputEvent{constructor(e,t){super(e,t===o.Error?"stderr":t===o.Warn?"console":"stdout")}}t.LogOutputEvent=a,t.trimLastNewline=function(e){return e.replace(/(\n|\r\n)$/,"")}},212:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingDebugSession=void 0;const i=n(100),s=i.logger,o=n(651);class r extends o.DebugSession{constructor(e,t,n){super(t,n),this.obsolete_logFilePath=e,this.on("error",(e=>{s.error(e.body)}))}start(e,t){super.start(e,t),s.init((e=>this.sendEvent(e)),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof i.LogOutputEvent)){let t=e;e instanceof o.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t={...e},t.body={...e.body,output:"<output not logged>"}),s.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,n,i){s.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${n}`),super.sendRequest(e,t,n,i)}sendResponse(e){s.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){s.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}}t.LoggingDebugSession=r},955:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Handles=t.Response=t.Event=t.ErrorDestination=t.CompletionItem=t.Module=t.Source=t.Breakpoint=t.Variable=t.Scope=t.StackFrame=t.Thread=t.MemoryEvent=t.InvalidatedEvent=t.ProgressEndEvent=t.ProgressUpdateEvent=t.ProgressStartEvent=t.CapabilitiesEvent=t.LoadedSourceEvent=t.ModuleEvent=t.BreakpointEvent=t.ThreadEvent=t.OutputEvent=t.ContinuedEvent=t.StoppedEvent=t.ExitedEvent=t.TerminatedEvent=t.InitializedEvent=t.logger=t.Logger=t.LoggingDebugSession=t.DebugSession=void 0;const i=n(651);Object.defineProperty(t,"DebugSession",{enumerable:!0,get:function(){return i.DebugSession}}),Object.defineProperty(t,"InitializedEvent",{enumerable:!0,get:function(){return i.InitializedEvent}}),Object.defineProperty(t,"TerminatedEvent",{enumerable:!0,get:function(){return i.TerminatedEvent}}),Object.defineProperty(t,"ExitedEvent",{enumerable:!0,get:function(){return i.ExitedEvent}}),Object.defineProperty(t,"StoppedEvent",{enumerable:!0,get:function(){return i.StoppedEvent}}),Object.defineProperty(t,"ContinuedEvent",{enumerable:!0,get:function(){return i.ContinuedEvent}}),Object.defineProperty(t,"OutputEvent",{enumerable:!0,get:function(){return i.OutputEvent}}),Object.defineProperty(t,"ThreadEvent",{enumerable:!0,get:function(){return i.ThreadEvent}}),Object.defineProperty(t,"BreakpointEvent",{enumerable:!0,get:function(){return i.BreakpointEvent}}),Object.defineProperty(t,"ModuleEvent",{enumerable:!0,get:function(){return i.ModuleEvent}}),Object.defineProperty(t,"LoadedSourceEvent",{enumerable:!0,get:function(){return i.LoadedSourceEvent}}),Object.defineProperty(t,"CapabilitiesEvent",{enumerable:!0,get:function(){return i.CapabilitiesEvent}}),Object.defineProperty(t,"ProgressStartEvent",{enumerable:!0,get:function(){return i.ProgressStartEvent}}),Object.defineProperty(t,"ProgressUpdateEvent",{enumerable:!0,get:function(){return i.ProgressUpdateEvent}}),Object.defineProperty(t,"ProgressEndEvent",{enumerable:!0,get:function(){return i.ProgressEndEvent}}),Object.defineProperty(t,"InvalidatedEvent",{enumerable:!0,get:function(){return i.InvalidatedEvent}}),Object.defineProperty(t,"MemoryEvent",{enumerable:!0,get:function(){return i.MemoryEvent}}),Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return i.Thread}}),Object.defineProperty(t,"StackFrame",{enumerable:!0,get:function(){return i.StackFrame}}),Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return i.Scope}}),Object.defineProperty(t,"Variable",{enumerable:!0,get:function(){return i.Variable}}),Object.defineProperty(t,"Breakpoint",{enumerable:!0,get:function(){return i.Breakpoint}}),Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return i.Source}}),Object.defineProperty(t,"Module",{enumerable:!0,get:function(){return i.Module}}),Object.defineProperty(t,"CompletionItem",{enumerable:!0,get:function(){return i.CompletionItem}}),Object.defineProperty(t,"ErrorDestination",{enumerable:!0,get:function(){return i.ErrorDestination}});const s=n(212);Object.defineProperty(t,"LoggingDebugSession",{enumerable:!0,get:function(){return s.LoggingDebugSession}});const o=n(100);t.Logger=o;const r=n(601);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return r.Event}}),Object.defineProperty(t,"Response",{enumerable:!0,get:function(){return r.Response}});const a=n(527);Object.defineProperty(t,"Handles",{enumerable:!0,get:function(){return a.Handles}});const p=o.logger;t.logger=p},601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=t.Response=t.Message=void 0;class n{constructor(e){this.seq=0,this.type=e}}t.Message=n,t.Response=class extends n{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}},t.Event=class extends n{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}},839:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolServer=void 0;const i=n(361),s=n(601);class o{get event(){return this._event||(this._event=(e,t)=>{let n;return this._listener=e,this._this=t,n={dispose:()=>{this._listener=void 0,this._this=void 0}},n}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch(e){}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}}class r extends i.EventEmitter{constructor(){super(),this._sendMessage=new o,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if("request"===e.type)this.dispatchRequest(e);else if("response"===e.type){const t=e,n=this._pendingRequests.get(t.request_seq);n&&(this._pendingRequests.delete(t.request_seq),n(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._sequence=1,this._writableStream=t,this._rawData=Buffer.alloc(0),e.on("data",(e=>this._handleData(e))),e.on("close",(()=>{this._emitEvent(new s.Event("close"))})),e.on("error",(e=>{this._emitEvent(new s.Event("error","inStream error: "+(e&&e.message)))})),t.on("error",(e=>{this._emitEvent(new s.Event("error","outStream error: "+(e&&e.message)))})),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,n,i){const o={command:e};if(t&&Object.keys(t).length>0&&(o.arguments=t),this._send("request",o),i){this._pendingRequests.set(o.seq,i);const e=setTimeout((()=>{clearTimeout(e);const t=this._pendingRequests.get(o.seq);t&&(this._pendingRequests.delete(o.seq),t(new s.Response(o,"timeout")))}),n)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){const e=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(e,"utf8")}\r\n\r\n${e}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){const e=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,e.length>0)try{let t=JSON.parse(e);this.handleMessage(t)}catch(e){this._emitEvent(new s.Event("error","Error handling data: "+(e&&e.message)))}continue}}else{const e=this._rawData.indexOf(r.TWO_CRLF);if(-1!==e){const t=this._rawData.toString("utf8",0,e).split("\r\n");for(let e=0;e<t.length;e++){const n=t[e].split(/: +/);"Content-Length"==n[0]&&(this._contentLength=+n[1])}this._rawData=this._rawData.slice(e+r.TWO_CRLF.length);continue}}break}}}t.ProtocolServer=r,r.TWO_CRLF="\r\n\r\n"},153:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runDebugAdapter=void 0;const i=n(808);t.runDebugAdapter=function(e){let t=0;if(process.argv.slice(2).forEach((function(e,n,i){const s=/^--server=(\d{4,5})$/.exec(e);s&&(t=parseInt(s[1],10))})),t>0)console.error(`waiting for debug protocol on port ${t}`),i.createServer((t=>{console.error(">> accepted connection from client"),t.on("end",(()=>{console.error(">> client connection closed\n")}));const n=new e(!1,!0);n.setRunAsServer(!0),n.start(t,t)})).listen(t);else{const t=new e(!1);process.on("SIGTERM",(()=>{t.shutdown()})),t.start(process.stdin,process.stdout)}}},29:(e,t)=>{function n(){this.waiters=[]}n.prototype.wait=function(e){var t=this,n={};this.waiters.push(n);var i=new Promise((function(e){var i=!1;n.resolve=function(s){if(!i){if(i=!0,n.timeout&&(clearTimeout(n.timeout),n.timeout=null),!s){var o=t.waiters.indexOf(n);o>-1&&t.waiters.splice(o,1)}e()}}}));return e>0&&isFinite(e)&&(n.timeout=setTimeout((function(){n.timeout=null,n.resolve()}),e)),i},n.prototype.notify=function(){this.waiters.length>0&&this.waiters.pop().resolve(!0)},n.prototype.notifyAll=function(){for(var e=this.waiters.length-1;e>=0;e--)this.waiters[e].resolve(!0);this.waiters=[]},t.Subject=n},603:(e,t,n)=>{"use strict";var i=n(436),s=n(308);function o(e){var t={};return t=i.extractLabel(e,t),t=i.extractComment(t.lineExpression,t),t=i.extractIndentation(t.lineExpression,t),delete(t=i.extractRoutines(t.lineExpression,t)).lineExpression,t}function r(e){var t="";return t=s.appendLabel(e,t),t=s.appendIndentation(e,t),t=s.appendRoutines(e,t),s.appendComment(e,t)}e.exports.parse=function(e){for(var t=(e=e.replace("\r","")).split("\n"),n=[],i=0;i<t.length;i++){var s=o(t[i]);s.lineNumber=i+1,n.push(s)}return n},e.exports.render=function(e){var t="",n=[];Array.isArray(e)?n=e:n.push(e);for(var i=0;i<n.length;i++){var s=r(n[i]);i===n.length-1?t+=s:t=t+s+"\n"}return t}},436:e=>{"use strict";function t(e){for(var t=[],n=0,i=0;i<=e.length;i++)" "===e[i]||"\t"===e[i]?e.substring(0,i).split('"').length%2!=0&&e.substring(i).split('"').length%2!=0&&(e.substring(n,i).length>0?t.push(e.substring(n,i)):0!==e.substring(n,i).length||" "!==e.substring(n-1,n)&&"\t"!==e.substring(n-1,n)||t.push(e.substring(n,i)),n=i+1):i===e.length&&(e.substring(n,i).length>0?t.push(e.substring(n,i)):i!==n||" "!==e.substring(i-1,i)&&"/t"!==e.substring(i-1,i)||t.push(""));return t}function n(e){for(var t=e,n=0;n<t.length;n++)if(t[n].mRoutine){var i=t[n].mRoutine.indexOf(":");i>-1&&(t[n].mPostConditional=t[n].mRoutine.substring(i+1),t[n].mRoutine=t[n].mRoutine.substring(0,i))}return t}e.exports.extractLabel=function(e,t){for(var n=0;n<=e.length;n++){if(" "!==e[n]&&"\t"!==e[n]){if(0===n){t.lineLabel=e.split(/[ \t]/,1)[0];for(var i=t.lineLabel.length;i<=e.length;i++){if(" "!==e[i]&&"\t"!==e[i]){t.lineLeadSpace=e.substring(t.lineLabel.length,i),t.lineExpression=e.substring(i);break}if(i===e.length-1){t.lineLeadSpace=e.substring(t.lineLabel.length),t.lineExpression="";break}}break}t.lineLeadSpace=e.substring(0,n),t.lineExpression=e.substring(n);break}if(n===e.length-1){t.lineLeadSpace=e,t.lineExpression="";break}}return t},e.exports.extractComment=function(e,t){if(e.search(";")>=0){for(var n=0;n<e.length;n++)if(";"===e[n]){if(e.substring(0,n).split('"').length%2!=0&&e.substring(n).split('"').length%2!=0){t.lineExpression=e.substring(0,n),t.lineComment=e.substring(n).substring(1);break}if(e.substring(0,n).replace("").split('"').length%2!=0&&e.substring(n).split('"').length%2==0){t.lineExpression=e.substring(0,n),t.lineComment=e.substring(n).substring(1);break}t.lineExpression=e}return t}return t.lineExpression=e,t},e.exports.extractIndentation=function(e,t){for(var n=[],i=0,s=0,o=0,r=0;r<=e.length;r++)if("."===e[r])0!==i&&(o=r,n.push(e.substring(s,o))),s=r+1,i++;else{if("."!==e[r]&&" "!==e[r]&&"\t"!==e[r]){0!==i&&(o=r,n.push(e.substring(s,o)),t.lineExpression=e.substring(r));break}if(r===e.length-1){o=r+1,n.push(e.substring(s,o)),t.lineExpression=e.substring(r+1);break}}return n.length>0?t.lineIndentationArray=n:t.lineExpression=e,t},e.exports.splitRoutinesAndArguments=t,e.exports.extractPostConditional=n,e.exports.extractRoutines=function(e,i){for(var s={},o=[],r=t(e),a=0;a<r.length;){if(a%2==0)s.mRoutine=r[a];else{s.mArguments=r[a];for(var p=a+1;p<r.length&&""===r[p];)r.splice(p,1),s.mArguments=s.mArguments+" ";o.push(s),s={}}r.length%2!=0&&r.length>0&&a===r.length-1&&(s.mRoutine=r[a],o.push(s),s={}),a++}var c=n(o);return c.length>0&&(i.lineRoutines=c),i}},308:e=>{"use strict";e.exports.appendLabel=function(e,t){return e.lineLabel&&(t+=e.lineLabel),e.lineLeadSpace&&(t+=e.lineLeadSpace),t},e.exports.appendIndentation=function(e,t){var n="";if(e.lineIndentationArray&&e.lineIndentationArray.length>0){for(var i in e.lineIndentationArray)n=n+"."+e.lineIndentationArray[i];t+=n}return t},e.exports.appendRoutines=function(e,t){if(e.lineRoutines)for(var n in e.lineRoutines)(e.lineRoutines[n].mRoutine||""===e.lineRoutines[n].mRoutine)&&("0"===n?t+=e.lineRoutines[n].mRoutine:t=t+" "+e.lineRoutines[n].mRoutine,e.lineRoutines[n].mPostConditional&&(t=t+":"+e.lineRoutines[n].mPostConditional),e.lineRoutines[n].hasOwnProperty("mArguments")&&(t=t+" "+e.lineRoutines[n].mArguments));return t},e.exports.appendComment=function(e,t){return e.hasOwnProperty("lineComment")&&(t=t+";"+e.lineComment),t}},112:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{p(i.next(e))}catch(e){o(e)}}function a(e){try{p(i.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}p((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const s=n(496),o=n(379),r=n(64),a=n(31),p=n(223),c=n(806),l=n(385),u=n(766),h=n(185),d=n(971),m=n(226),g=n(293),b=n(938),f=n(608),E=n(730),v=n(289),T=n(147);let y;t.activate=function(e){return i(this,void 0,void 0,(function*(){const t={language:"mumps",scheme:"file"},n=s.languages.createDiagnosticCollection("mumps");let i="";if(void 0!==e.storageUri){i=e.storageUri.fsPath,T.existsSync(i)||T.mkdirSync(i);const n=i+"/labeldb.json";e.subscriptions.push(s.languages.registerCompletionItemProvider(t,new f.default(n)))}const p=e.workspaceState;e.subscriptions.push(s.commands.registerCommand("mumps.documentFunction",(()=>{(0,b.default)()})),s.commands.registerCommand("mumps.autoSpaceEnter",(()=>{(0,o.autoSpaceEnter)()})),s.commands.registerCommand("mumps.autoSpaceTab",(()=>{(0,o.autoSpaceTab)()})),s.commands.registerCommand("mumps.toggleExpandedCommands",(()=>{(0,E.default)(p)})),s.commands.registerCommand("mumps.getEntryRef",(()=>s.window.showInputBox({placeHolder:"Please enter the Entry-Reference to start Debugging",value:""}))),s.languages.registerHoverProvider(t,new d.default),s.languages.registerDefinitionProvider(t,new l.default),s.languages.registerEvaluatableExpressionProvider(t,new u.default),s.languages.registerSignatureHelpProvider(t,new g.default,"(",","),s.languages.registerDocumentSymbolProvider(t,new c.default),s.languages.registerDocumentSemanticTokensProvider(t,r.MumpsHighlighter,r.SemanticTokens),s.languages.registerDocumentFormattingEditProvider(t,new h.default),s.languages.registerDocumentRangeFormattingEditProvider(t,new h.default),s.languages.registerReferenceProvider(t,new m.default),s.debug.registerDebugConfigurationProvider("mumps",new a.default),s.debug.registerDebugAdapterDescriptorFactory("mumps",new R),s.window.onDidChangeActiveTextEditor((e=>{e&&_(e.document,n)})),s.workspace.onDidChangeTextDocument((e=>{e&&_(e.document,n)})),s.workspace.onDidOpenTextDocument((e=>{_(e,n)})))}))},t.deactivate=function(){};class R{createDebugAdapterDescriptor(){return new s.DebugAdapterInlineImplementation(new p.default)}}function _(e,t){y&&(clearTimeout(y),y=void 0),y=setTimeout((()=>new v.default(e,t)),500)}},776:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.definitionsArray=void 0,t.definitionsArray=[{name:"BREAK",type:"command",abbreviation:"B",description:"Suspend execution or exit a block"},{name:"CLOSE",type:"command",abbreviation:"C",description:"Release an I/O device"},{name:"DO",type:"command",abbreviation:"D",description:"Execute a program, section of code or block"},{name:"ELSE",type:"command",abbreviation:"E",description:"Conditional execution based on $test"},{name:"FOR",type:"command",abbreviation:"F",description:"Iterative execution of a line or block"},{name:"GOTO",type:"command",abbreviation:"G",description:"Transfer of control to a label or program"},{name:"HALT",type:"command",abbreviation:"H",description:"Terminate execution"},{name:"HANG",type:"command",abbreviation:"H",description:"Delay execution for a specified period of time"},{name:"IF",type:"command",abbreviation:"I",description:"Conditional execution of remainder of line"},{name:"JOB",type:"command",abbreviation:"J",description:"Start an independent process"},{name:"LOCK",type:"command",abbreviation:"L",description:"Exclusive access/release named resource"},{name:"KILL",type:"command",abbreviation:"K",description:"Deletes a local or global variable"},{name:"MERGE",type:"command",abbreviation:"M",description:"Copy arrays"},{name:"NEW",type:"command",abbreviation:"N",description:"Create new copies of local variables"},{name:"OPEN",type:"command",abbreviation:"O",description:"Obtain ownership of a device"},{name:"QUIT",type:"command",abbreviation:"Q",description:"End a for loop or exit a block"},{name:"READ",type:"command",abbreviation:"R",description:"Read from a device"},{name:"SET",type:"command",abbreviation:"S",description:"Assign a value to a global or local variable"},{name:"TCOMMIT",type:"command",abbreviation:"TC",description:"Commit a transaction"},{name:"TRESTART",type:"command",abbreviation:"TRE",description:"Roll back / restart a transaction"},{name:"TROLLBACK",type:"command",abbreviation:"TRO",description:"Roll back a transaction"},{name:"TSTART",type:"command",abbreviation:"TS",description:"Begin a transaction"},{name:"USE",type:"command",abbreviation:"U",description:"Select which device to read/write"},{name:"VIEW",type:"command",abbreviation:"V",description:"Implementation defined"},{name:"WRITE",type:"command",abbreviation:"W",description:"Write to device"},{name:"XECUTE",type:"command",abbreviation:"X",description:"Dynamically execute strings"},{name:"ZALLOCATE",type:"command",abbreviation:"ZA",description:"Reserves the specified name"},{name:"ZBREAK",type:"command",abbreviation:"ZB",description:"Sets or clears a routine breakpoint"},{name:"ZCOMPILE",type:"command",abbreviation:"ZCOM",description:"Compiles a routine"},{name:"ZCONTINUE",type:"command",abbreviation:"ZC",description:"Continues excutioen after a break"},{name:"ZDEALLOCATE",type:"command",abbreviation:"ZD",description:"Release the specified name"},{name:"ZEDIT",type:"command",abbreviation:"ZE",description:"Invokes editor for routine editing"},{name:"ZGOTO",type:"command",abbreviation:"ZG",description:"Moves to EntryRef on a given stacklevel"},{name:"ZHALT",type:"command",abbreviation:"ZHALT",description:"Stops program execution with a return code"},{name:"ZHELP",type:"command",abbreviation:"ZH",description:"Accessses M help library"},{name:"ZKILL",type:"command",abbreviation:"ZK",description:"Kills a data value but not the descendants"},{name:"ZLINK",type:"command",abbreviation:"ZL",description:"Compiles an links a routine to the current process"},{name:"ZMESSAGE",type:"command",abbreviation:"ZM",description:"Raises an exception specified by given code"},{name:"ZPRINT",type:"command",abbreviation:"ZP",description:"Displays source code lines"},{name:"ZRUPDATE",type:"command",abbreviation:"ZRUPDATE",description:"Publishes the new versions of routines to subscribers"},{name:"ZSHOW",type:"command",abbreviation:"ZSH",description:"Displays information about the current environment"},{name:"ZSTEP",type:"command",abbreviation:"ZST",description:"Controls routine execution"},{name:"ZSYSTEM",type:"command",abbreviation:"ZSY",description:"Creates a child of the current process"},{name:"ZTCOMMIT",type:"command",abbreviation:"ZTC",description:"Marks the end of a logical transaction"},{name:"ZTRIGGER",type:"command",abbreviation:"ZTR",description:"Invokes specified Global Triggers"},{name:"ZTSTART",type:"command",abbreviation:"ZTS",description:"Marks the beginning of a logical transaction"},{name:"ZWITHDRAW",type:"command",abbreviation:"ZWI",description:"Kills a data value but not the descendants"},{name:"ZWRITE",type:"command",abbreviation:"ZWR",description:"Displays a complete global or local variable"},{name:"$DEVICE",type:"variable",abbreviation:"$D",description:"Status of the current device"},{name:"$ECODE",type:"variable",abbreviation:"$EC",description:"List of unresolved error codes"},{name:"$ESTACK",type:"variable",abbreviation:"$ES",description:"Number of stack levels; NEWing $ESTACK resets it to 0"},{name:"$ETRAP",type:"variable",abbreviation:"$ET",description:"Code to execute on error"},{name:"$HOROLOG",type:"variable",abbreviation:"$H",description:"Days,seconds time stamp"},{name:"$IO",type:"variable",abbreviation:"$I",description:"Current IO unit"},{name:"$JOB",type:"variable",abbreviation:"$J",description:"Current process ID"},{name:"$KEY",type:"variable",abbreviation:"$K",description:"String that terminated the most recent READ command"},{name:"$PRINCIPAL",type:"variable",abbreviation:"$P",description:"Principal I/O device"},{name:"$QUIT",type:"variable",abbreviation:"$Q",description:"Whether the current block of code was called as an extrinsic function (e.g. via $$)"},{name:"$STACK",type:"variable",abbreviation:"$ST",description:"Current process stack level"},{name:"$STORAGE",type:"variable",abbreviation:"$S",description:"Amount of memory available, in bytes"},{name:"$SYSTEM",type:"variable",abbreviation:"$SY",description:"System ID"},{name:"$TEST",type:"variable",abbreviation:"$T",description:"Result of prior IF command or READ/OPEN/LOCK command if invoked with a timeout"},{name:"$TLEVEL",type:"variable",abbreviation:"$TL",description:"Number transactions in process"},{name:"$TRESTART",type:"variable",abbreviation:"$TR",description:"Number of restarts on current transaction"},{name:"$X",type:"variable",abbreviation:"$X",description:"Position of horizontal cursor in current I/O device"},{name:"$Y",type:"variable",abbreviation:"$Y",description:"Position of vertical cursor in current I/O device"},{name:"$ASCII",type:"function",abbreviation:"$A",description:"ASCII numeric code of a character",parameters:[{name:"VALUE",type:"string",description:"A string to get a code from"},{name:"POS",type:"number",optional:!0,description:"The 1-based position of the character in VALUE; defaults to 1"}],returns:{type:"number"}},{name:"$CHAR",type:"function",abbreviation:"$C",description:"ASCII character from numeric code",parameters:[{name:"CODE",type:"number",description:"Numeric code to convert to a character"},{name:"...",type:"number",optional:!0,description:"Additional codes to convert to characters"}],returns:{type:"string"}},{name:"$DATA",type:"function",abbreviation:"$D",description:"Returns data about a variable: 0: if undefined, 1: if valued but has no descendants, 10: if has descendants but no value; 11: if has both a value and descendants",parameters:[{name:"VAR",type:"reference",description:"The variable to get data about, e.g. ^X"}],returns:{type:"number"}},{name:"$EXTRACT",type:"function",abbreviation:"$E",description:"Extract a substring",parameters:[{name:"VALUE",type:"string",description:"The string to get a substring from"},{name:"START",type:"number",optional:!0,description:"The 1-based start index; defaults to 1"},{name:"END",type:"number",optional:!0,description:"The 1-based end index; defaults to 2"}],returns:{type:"string"}},{name:"$FIND",type:"function",abbreviation:"$F",description:"Find the 1-based index after the end of a substring or 0 if not found",parameters:[{name:"WITHIN",type:"string",description:"The string to search in"},{name:"SUBSTRING",type:"string",description:"The substring to search for"},{name:"START",type:"number",optional:!0,description:"The 1-based index to start searching from; defaults to 1"}],returns:{type:"number"}},{name:"$FNUMBER",type:"function",abbreviation:"$FN",description:"Format a number",parameters:[{name:"NUMBER",type:"number",description:"The number to format"},{name:"FORMAT",type:"string",description:'One or more of the following: +: forces "+" on positive numbers; -: omits the "-" on negative numbers; ,: comma-separates the number by thousands; T: puts the sign in the trailing position; P: wraps negative numbers in parentheses and wraps positive numbers in spaces and may only be combined with comma (,)'},{name:"DIGITS",type:"number",optional:!0,description:"The numer of digits after the decimal point"}],returns:{type:"any"}},{name:"$GET",type:"function",abbreviation:"$G",description:"Get default or actual value",parameters:[{name:"VAR",type:"reference",description:"The variable to query, e.g. ^X(THIS,THAT)"},{name:"DEFAULT",type:"any",optional:!0,description:'A value to use if VAR has no value; defaults to ""'}],returns:{type:"any"}},{name:"$JUSTIFY",type:"function",abbreviation:"$J",description:"Right-justify a number or string by prefixing with spaces",parameters:[{name:"VALUE",type:"string",description:"The string to justify"},{name:"MINLENGTH",type:"number",description:"The minimum length of the result"},{name:"DIGITS",type:"number",description:"The number of digits after the decimal point; providing this argument makes $JUSTIFY treat VALUE as a number"}],returns:{type:"string"}},{name:"$LENGTH",type:"function",abbreviation:"$L",description:"Determine string length",parameters:[{name:"VALUE",type:"string",description:"The string"},{name:"SUBSTRING",type:"string",optional:!0,description:"If present, $LENGTH returns one more than the number of occurences of SUBSTRING in VALUE"}],returns:{type:"number"}},{name:"$NAME",type:"function",abbreviation:"$NA",description:"Evaluate and describe a variable",parameters:[{name:"VAR",type:"reference",description:"The variable to evaluate, including naked references"},{name:"MAXSUBSCRIPT",type:"number",optional:!0,description:"The maximum number of subscripts to evaluate if VAR is an array"}],returns:{type:"string"}},{name:"$ORDER",type:"function",abbreviation:"$O",description:"Find the subscript of the next or previous node",parameters:[{name:"VAR",type:"reference",description:"The array to query, e.g. ^AR"},{name:"DIRECTION",type:"number",optional:!0,description:"1: forward, -1: reverse; defaults to 1"}],returns:{type:"string|number"}},{name:"$PIECE",type:"function",abbreviation:"$P",description:"Extract substring based on pattern",parameters:[{name:"VALUE",type:"string",description:"The string"},{name:"SUBSTRING",type:"string",description:"A delimiting string within VALUE"},{name:"PIECE",type:"number",optional:!0,description:"Which 1-based piece of the split string to return; defaults to 1"},{name:"LASTPIECE",type:"number",optional:!0,description:"The 1-based index of the last piece of the split string to return; defaults to PIECE"}],returns:{type:"any"}},{name:"$QLENGTH",type:"function",abbreviation:"$QL",description:"Number of subscripts in an array reference",parameters:[{name:"VAR",type:"reference",description:"The array to query, e.g. ^AR"}],returns:{type:"any"}},{name:"$QSUBSCRIPT",type:"function",abbreviation:"$QS",description:"Value of specified subscript",parameters:[{name:"VAR",type:"reference",description:"The array to query, e.g. ^AR"},{name:"SUBSCRIPT",type:"number",description:"The 1-based index of the subscript to find; special values include -1: environment and 0: unsubscripted name"}],returns:{type:"string|number"}},{name:"$QUERY",type:"function",abbreviation:"$Q",description:"Next item in an array; invoke multiple times to iterate the entire array",parameters:[{name:"VAR",type:"reference",description:"The array to query, e.g. ^AR"}],returns:{type:"any"}},{name:"$RANDOM",type:"function",abbreviation:"$R",description:"Random number",parameters:[{name:"LIMIT",type:"number",description:"The generated random number will be between 0 (inclusive) and this LIMIT (exclusive)"}],returns:{type:"number"}},{name:"$REVERSE",type:"function",abbreviation:"$RE",description:"String in reverse order",parameters:[{name:"VALUE",type:"string",description:"A string to reverse"}],returns:{type:"string"}},{name:"$SELECT",type:"function",abbreviation:"$S",description:"Value of first true argument",parameters:[{name:"TVEXPR",type:"expression",description:'An expression to test for truth, followed by a colon and a value, e.g. i=42:"Answered!"'},{name:"...",type:"expression",optional:!0,description:"Additional truth value expressions to test; the last expression often starts with 1: to avoid errors"}],returns:{type:"any"}},{name:"$STACK",type:"function",abbreviation:"$ST",description:"Returns information about the process stack",parameters:[{name:"LEVEL",type:"number",description:"-1: returns the highest stack level; 0: returns information about how the program was started; 1 to $STACK(-1): returns information about how the stack level was created"},{name:"FIELD",type:"string",optional:!0,description:'"MCODE": the line of code that was executed; "PLACE": location of the executed code; "ECODE": the error code(s) added at the stack level, if any'}],returns:{type:"string|number"}},{name:"$TEXT",type:"function",abbreviation:"$T",description:"Returns the text of a line of M[UMPS] code",parameters:[{name:"REFERENCE",type:"string",description:"A reference to a code location, e.g. 'LABEL' or '+4^PROGRAM' or 'LABEL^PROGRAM', etc."}],returns:{type:"string"}},{name:"$TRANSLATE",type:"function",abbreviation:"$TR",description:"Translate characters in a string",parameters:[{name:"VALUE",type:"string",description:"The value to translate"},{name:"OLD",type:"string",description:"Characters in VALUE to replace"},{name:"NEW",type:"string",optional:!0,description:"Characters to replace OLD characters with; if not provided then OLD characters will be removed"}],returns:{type:"string"}},{name:"$VIEW",type:"function",abbreviation:"$V",description:"Implementation defined"},{name:"$ZAHANDLE",type:"function",abbreviation:"$ZAH",description:"Returns unique identifier for a name or an alias container",parameters:[{name:"VAR",type:"reference",description:"The variable to find the handle for e.g"}],returns:{type:"string"}},{name:"$ZASCII",type:"function",abbreviation:"$ZA",description:"ASCII numeric code of a 8-bit character",parameters:[{name:"VALUE",type:"string",description:"A string to get a code from"},{name:"POS",type:"number",optional:!0,description:"The 1-based position of the byte in VALUE; defaults to 1"}],returns:{type:"number"}},{name:"$ZATRANSFORM",type:"function",abbreviation:"$ZATR",description:"Returns the transformed representation of the first argument expr in a normalized form using the alternative transform specified by the second argument intexpr; the return can be used as an operand to the follows (]) or sorts-after (]]) operator such that, if both operands are in the normalized form, the result is independent of alternative collation.",parameters:[{name:"VALUE",type:"string",description:"String to transform"},{name:"ID",type:"Number",optional:!1,description:"ID of the alternative transform to use"},{name:"NORMALIZE",type:"Number",optional:!0,description:"whether the transform is to normalized form, by default or if zero (0), or, if one (1), the reverse transform from the normalized to the native form"},{name:"MCOLLATION",type:"Number",optional:!0,description:"whether to use standard M collation of numbers before strings, the default or zero (0), or to sort all values as strings (1)"}],returns:{type:"string"}},{name:"$ZBITAND",type:"function",abbreviation:"$ZBITAND",description:"Performs a logical AND function on two bit strings and returns a bit string equal in length to the shorter of the two arguments (containing set bits in those positions where both of the input strings have set bits). Positions corresponding to positions where either of the input strings have a cleared bit, also have cleared bits in the resulting string",parameters:[{name:"FIRSTEXPR",type:"string",description:"first expression"},{name:"2NDEXPR",type:"string",optional:!1,description:"second expression"}],returns:{type:"string"}},{name:"$ZBITCOUNT",type:"function",abbreviation:"$ZBITCOUNT",description:"Returns the number of ON bits in a bit string.",parameters:[{name:"EXPR",type:"string",description:"The expression specifies the bit string to examine"}],returns:{type:"number"}},{name:"$ZBITFIND",type:"function",abbreviation:"$ZBITFIND",description:"Performs the analog of $FIND() on a bit string. It returns an integer that identifies the position after the first position equal to a truth-valued expression that occurs at, or after, the specified starting position",parameters:[{name:"VALUE",type:"string",description:"The expression specifies the bit string to examine"},{name:"TRUTHVALUE",type:"Number",optional:!0,description:"The truth-valued expression specifies the bit value for which $ZBITFIND() searches (1 or 0)"},{name:"POS",type:"Number",optional:!0,description:"The optional integer argument specifies the starting position at which to begin the search"}],returns:{type:"number"}},{name:"$ZBITGET",type:"function",abbreviation:"$ZBITGET",description:"",parameters:[{name:"VALUE",type:"string",description:"The expression specifies the bit string to examine"},{name:"POS",type:"Number",optional:!1,description:"The integer argument specifies the position in the string for which the value is requested"}],returns:{type:"number"}},{name:"$ZBITLEN",type:"function",abbreviation:"$ZBITLEN",description:"Returns the length of a bit string, in bits",parameters:[{name:"VALUE",type:"string",description:"The expression specifies the bit string to examine"}],returns:{type:"number"}},{name:"$ZBITNOT",type:"function",abbreviation:"$ZBITNOT",description:"Returns a copy of the bit string with each input bit position inverted",parameters:[{name:"VALUE",type:"string",description:"The expression specifies the bit string to invert"}],returns:{type:"string"}},{name:"$ZBITOR",type:"function",abbreviation:"$ZBITOR",description:"Performs a bitwise logical OR on two bit strings, and returns a bit string equal in length to the longer of the two arguments (containing set bits in those positions where either or both of the input strings have set bits). Positions that correspond to positions where neither input string has a set bit have cleared bits in the resulting string",parameters:[{name:"FIRSTEXPR",type:"string",description:"first expression"},{name:"2NDEXPR",type:"string",optional:!1,description:"second expression"}],returns:{type:"string"}},{name:"$ZBITSET",type:"function",abbreviation:"$ZBITSET",description:"Returns an edited copy of the input bit string with a specified bit set to the value of the truth-valued expression",parameters:[{name:"VALUE",type:"string",description:"The expression specifies the input bit string"},{name:"POS",type:"Number",optional:!1,description:"The integer expression specifies the position of the bit to manipulate. Arguments that are negative, zero, or exceed the length of the bit string produce a run-time error. $ZBIT functions count the first bit as position one (1)"},{name:"TRUTHVALUE",type:"Number",optional:!1,description:"The truth-valued expression specifies the value to which to set the specified bit (0 or 1)"}],returns:{type:"string"}},{name:"$ZBITSTR",type:"function",abbreviation:"$ZBITSTR",description:"Returns a bit string of a specified length with all bit positions initially set to either zero or one",parameters:[{name:"LENGTH",type:"Number",description:"The integer expression specifies the length of the bit string to return; arguments that exceed the maximum length of 253,952 produce a run-time error"},{name:"TRUTHVALUE",type:"Number",optional:!0,description:"The optional truth-valued expression specifies the value to which all bit positions should initially be set (0 or 1). If this argument is missing, the bits are set to zero"}],returns:{type:"number"}},{name:"$ZBITXOR",type:"function",abbreviation:"$ZBITXOR",description:"Performs a bitwise exclusive OR on two bit strings, and returns a bit string equal in length to the shorter of the two arguments (containing set bits in those positions where either (but not both) of the input strings have set bits). Positions that correspond to positions where neither or both input strings have a set bit have cleared bits in the resulting string",parameters:[{name:"FIRSTEXPR",type:"string",description:"first expression"},{name:"2NDEXPR",type:"string",optional:!1,description:"second expression"}],returns:{type:"string"}},{name:"$ZCHAR",type:"function",abbreviation:"$ZCH",description:"Returns a string composed of bytes represented by the integer octet values specified in its argument(s).",parameters:[{name:"Integer",type:"Number",description:"The integer expression(s) specify the numeric byte value of the byte(s) $ZCHAR() returns"},{name:"...",type:"number",optional:!0,description:"Additional codes to convert to characters"}],returns:{type:"string"}},{name:"$ZCOLLATE",type:"function",abbreviation:"$ZCO",description:"Returns the transformed representation of the first argument glvn in a normalized form using the alternative transform specified by the second argument intexpr; the return can be used as an operand to the follows (]) or sorts-after (]]) operator such that, if both operands are in the normalized form, the result is independent of alternative collation.",parameters:[{name:"var",type:"reference",description:"The subscripted or unsubscripted global or local variable name specifies the key to transform"},{name:"TransformId",type:"number",description:"Specifies the ID of the alternative transform to use"},{name:"NormForm",type:"number",optional:!0,description:"Specifies whether the transform is to normalized form, by default or if zero (0), or, if one (1), the reverse transform from the normalized to the native form."}],returns:{type:"string"}},{name:"$ZCONVERT",type:"function",description:"Returns its first argument as a string or value converted to a different encoding or numeric base. The two argument form changes the encoding for case within the ASCII character set. The three argument form changes the encoding scheme or base. Supported bases are decimal 'DEC' and 'HEX', case insensitive).",abbreviation:"$ZCO",parameters:[{name:"expr1",type:"any",description:"string or value to convert. $ZCONVERT() generates a run-time error if for Unicode conversion if the string contains a code-point value that is not in the character set, or for base conversion if the value to be converted is out of range"},{name:"expr2",type:"code",description:"Specifies a code that determines the form of the result."},{name:"expr3",type:"code",optional:!0,description:"Code that specifies the character set or base of the result"}],returns:{type:"string"}},{name:"$ZDATA",type:"function",abbreviation:"$ZDATA",description:"Extends $DATA() to reflect the current alias state of the lvn or name argument to identify alias and alias container variables. It treats variables joined through pass-by-reference as well as TP RESTART variables within a transaction as alias variables. However, it does not distinguish nodes having alias containers among their descendants.",parameters:[{name:"var",type:"reference",description:"Returns data about a variable: 0: if undefined, 1: if valued but has no descendants, 10: if has descendants but no value; 11: if has both a value and descendants; 100; 101; 111"}],returns:{type:"number"}},{name:"$ZDATE",type:"function",description:"Returns a date and/or time formatted as text based on an argument formatted in the manner of $HOROLOG",abbreviation:"$ZDATE",parameters:[{name:"expr1",type:"any",description:"$HOROLOG format of the date and/or time"},{name:"expr2",type:"string",optional:!0,description:"Pattern of desired output p.e. 'YEAR-MM-DD'"},{name:"expr3",type:"string",optional:!0,description:"Specifies a list of 12 month codes, separated by commas (,)"},{name:"expr4",type:"string",optional:!0,description:"Specifies a list of seven day codes, separated by commas (,)"}],returns:{type:"string"}},{name:"$ZEXTRACT",type:"function",abbreviation:"$ZE",description:"Returns a byte sequence from a given sequence of octets (8-bit bytes).",parameters:[{name:"expr1",type:"any",description:"Specifies a sequence of octets (8-bit bytes) from which $ZEXTRACT() derives a byte sequence"},{name:"intexpr1",type:"number",optional:!0,description:"Specifies the starting byte position in the byte string"},{name:"intexpr2",type:"number",optional:!0,description:"Specifies the ending byte position for the result"}],returns:{type:"string"}},{name:"$ZFIND",type:"function",abbreviation:"$ZF",description:"Returns an integer byte position that locates the occurrence of a byte sequence within a sequence of octets(8-bit bytes).",parameters:[{name:"expr1",type:"string",description:"Specifies the sequence of octets (8-bit bytes) in which $ZFIND() searches for the byte sequence"},{name:"expr2",type:"string",description:" specifies the byte sequence for which $ZFIND() searches"},{name:"expr3",type:"number",optional:!0,description:"Identifies the starting byte position for the $ZFIND() search"}],returns:{type:"number"}},{name:"$ZGETJPI",type:"function",description:"Returns job or process information of the specified process",abbreviation:"$ZGETJPI",parameters:[{name:"expr1",type:"any",description:"Identifies the PID of the target job. If expr1 is an empty string (), $ZGETJPI() returns information about the current process."},{name:"expr2",type:"string",description:"Specifies the item keyword identifying the type of information returned"}],returns:{type:"string"}},{name:"$ZJOBEXAM",type:"function",description:"Returns the full specification of the file specified by the optional expr1 argument into which the function places a ZSHOW output specified by expr2",abbreviation:"$ZJOBEXAM",parameters:[{name:"expr1",type:"any",description:"A template output device specification. It can be a device, a file directory, or a file name."},{name:"expr2",type:"",optional:!0,description:"Defaulting to '*', expr2 specifies the ZSHOW Information Codes of data to be included in the output"}],returns:{type:"string"}},{name:"$ZJUSTIFY",type:"function",abbreviation:"$ZJ",description:"",parameters:[{name:"expr1",type:"any",description:"The expression specifies the sequence of octets formatted by $ZJUSTIFY()."},{name:"expr2",type:"number",description:"Specifies the minimum size of the resulting byte sequence."},{name:"expr3",type:"",optional:!0,description:"The number of digits after the decimal point; providing this argument makes $ZJUSTIFY treat expr1 as a number"}],returns:{type:"string"}},{name:"$ZLENGTH",abbreviation:"$ZL",type:"function",description:"Returns the length of a sequence of octets measured in bytes, or in pieces separated by a delimiter specified by one of its arguments",parameters:[{name:"expr1",type:"any",description:"Specifies the sequence of octets that $ZLENGTH() measures."},{name:"expr2",type:"number",optional:!0,description:"specifies the delimiter that defines the measure; if this argument is missing, $ZLENGTH() returns the number of bytes in the sequence of octets."}],returns:{type:"string"}},{name:"$ZMESSAGE",type:"function",description:"Returns a message string associated with a specified status code .",abbreviation:"ZM",parameters:[{name:"expr1",type:"number",description:"The integer expression specifies the status code for which $ZMESSAGE() returns error message text ."}],returns:{type:"string"}},{name:"$ZPARSE",type:"function",description:"Expands a file name to a full pathname and then returns the full pathname or one of its fields (directory, name, or extension).",abbreviation:"$ZPARSE",parameters:[{name:"expr1",type:"any",description:"Specifies the file name; if the file name is not valid, $ZPARSE() returns a null string"},{name:"expr2",type:"string",optional:!0,description:"Specifies the field of the pathname that $ZPARSE() returns"},{name:"expr3",type:"",optional:!0,description:"Specify default values to use during file name expansion for missing fields (directory, name, or extension)"},{name:"expr4",type:"",optional:!0,description:"Specify default values to use during file name expansion for missing fields (directory, name, or extension)"},{name:"expr5",type:"",optional:!0,description:"Specifies the mode or type of parse that $ZPARSE() performs."}],returns:{type:"string"}},{name:"$ZPIECE",abbreviation:"$ZPI",type:"function",description:"Return a sequence of bytes delimited by a specified byte sequence made up of one or more bytes.",parameters:[{name:"expr1",type:"any",description:"specifies the sequence of octets from which $ZPIECE() takes its result."},{name:"expr2",type:"string",description:"Specifies the delimiting byte sequence that determines the piece 'boundaries'"},{name:"expr3",type:"",optional:!0,description:"Specifies the beginning piece to return"},{name:"expr4",type:"",optional:!0,description:"Specifies the last piece to return"}],returns:{type:"string"}},{name:"$ZPREVIOUS",abbreviation:"$ZP",type:"function",description:"Returns the subscript of the previous local or global variable name in collation sequence within the array level specified by its argument.",parameters:[{name:"glvn",type:"reference",description:"Specifies the node prior to which $ZPREVIOUS() searches backwards for a defined node with data and/or descendants."}],returns:{type:"string"}},{name:"$ZQGBLMOD",type:"function",description:"Enables an application to determine whether it can safely apply a lost transaction to the database.",abbreviation:"$ZQGBLMOD",parameters:[{name:"gvn",type:"reference",description:"The subscripted or non-subscripted global variable name (gvn) specifies the target node."}],returns:{type:"boolean"}},{name:"$ZSEARCH",type:"function",description:"Attempts to locate a file matching the specified file name. If the file exists, it returns the file name; if the file does not exist, it returns the null string.",abbreviation:"$ZSEARCH",parameters:[{name:"expr1",type:"any",description:"Contains a file name, with or without wildcards, for which $ZSEARCH() attempts to locate a matching file."},{name:"expr2",type:"number",optional:!0,description:"Specifies an integer expression that is a stream number. It can be any value from 0 to 255 for each search"}],returns:{type:"string"}},{name:"$ZSIGPROC",type:"function",description:"Sends a signal to a process. The format for the $ZSIGPROC function is",abbreviation:"$ZSIGPROC",parameters:[{name:"expr1",type:"number",description:"The pid of the process to which the signal is to be sent."},{name:"expr2",type:"string",description:"The system signal name (e.g., 'SIGUSR1' or just 'USR1')."}],returns:{type:"string"}},{name:"$ZSOCKET",type:"function",description:"Returns information about a SOCKET device and its attached sockets",abbreviation:"$ZSOCKET",parameters:[{name:"expr1",type:"any",description:"Specifies the SOCKET device name"},{name:"expr2",type:"string",description:"Specifies a keyword identifying the type of information returned"},{name:"expr3",type:"number",optional:!0,description:"Specifies the index (starting at zero) of a socket attached to the device"},{name:"expr4",type:"string",optional:!0,description:"Specifies an individual delimiter when the second expression specifies DELIMITER."}],returns:{type:"string"}}]},379:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{p(i.next(e))}catch(e){o(e)}}function a(e){try{p(i.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}p((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.autoSpaceEnter=t.autoSpaceTab=void 0;const s=n(496),o=n(603);t.autoSpaceEnter=function(){return i(this,void 0,void 0,(function*(){const e=s.window.activeTextEditor;if(e){const t=e.selection.active,n=e.document.lineAt(t.line).text,i=o.parse(n);let r="";0!==t.character&&((void 0===i[0].lineRoutines||0===i[0].lineRoutines.length)&&-1===n.indexOf(";")&&void 0!==i[0].lineIndentationArray&&i[0].lineIndentationArray.length>0?(i[0].lineIndentationArray.splice(-1),e.edit((e=>{e.replace(new s.Range(t.with(t.line,0),t.with(t.line,n.length)),o.render(i))}))):(void 0===i[0].lineIndentationArray&&(i[0].lineIndentationArray=[]),function(e){const t=e.lineRoutines;if(t)for(let e=0;e<t.length;e++)if(t[e].mRoutine.match(/(d|do)/i)&&!t[e].mArguments)return!0;return!1}(i[0])&&i[0].lineIndentationArray.push(" "),i[0].lineRoutines=[],delete i[0].lineComment,delete i[0].lineLabel,r=o.render(i))),e.edit((e=>{e.insert(t,"\n"+r)}))}}))},t.autoSpaceTab=function(){return i(this,void 0,void 0,(function*(){const e=s.window.activeTextEditor;if(e){const t=e.selection.active,n=e.document.lineAt(t.line).text,i=o.parse(n);(void 0===i[0].lineRoutines||0===i[0].lineRoutines.length)&&-1===n.indexOf(";")&&void 0!==i[0].lineIndentationArray&&i[0].lineIndentationArray.length>0?(i[0].lineIndentationArray.push(" "),e.edit((e=>{" "===n.charAt(t.character-1)?e.insert(t.with(t.line,t.character),". "):e.insert(t.with(t.line,t.character)," . ")}))):e.edit((e=>{e.insert(t,"\t")}))}}))}},730:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s=new(n(105).MumpsLineParser);t.default=function(e){let t=!0;const n=i.window.activeTextEditor;if(n){const o=n.document.fileName;!0===e.get(o+"_expandState")?(t=!1,e.update(o+"_expandState",!1)):e.update(o+"_expandState",!0);const r=n.document.getText().split("\n"),a=r.length;if(a){const e=r[a-1].length;for(let e=0;e<a;e++){const n=s.expandCompressLine(r[e],t);""===n.errorText&&(r[e]=n.lineText)}n.edit((t=>{t.replace(new i.Range(0,0,a,e),r.join("\n"))}))}}}},608:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s=new(n(105).MumpsLineParser),o=n(147);t.default=class{constructor(e){this._labelsReady=!1,this._dbfile=e,this._refreshLabelDB()}provideCompletionItems(e,t){const n=function(e,t){let n="lineStart",i=0,s="",o="",r=!1;if(e)for(;i<t;){const t=e.substring(i,++i),a=" "===t||"\t"===t,p=t.match(/[A-Za-z%^]/),c=t.match(/[A-Za-z]/);if("string"!==n&&";"===t)return{lineStatus:"comment",startstring:""};switch(p||""!==o&&t.match(/[0-9]/)?o+=t:o="",n){case"argument":a?r?(r=!1,s.match(/[D|DO|G|GOTO|J|JOB]/i)&&(n="jumplabel")):(n="command",s=""):'"'===t?n="string":p?n="variable":"$"===t&&(n="function");break;case"command":if(":"===t)n="argument",r=!0;else{if(c){s+=t;break}if(!a)return n="error",{lineStatus:"error",startstring:""};n="argument",s.match(/[D|DO|G|GOTO|J|JOB]/i)&&(n="jumplabel")}break;case"function":a?r?r=!1:(n="command",s=""):"$"===t?n="jumplabel":p||(n="argument");break;case"jumplabel":a?(n="command",s=""):(":"===t||"("===t)&&(n="argument");break;case"label":a?n="command":"("===t&&(n="variable");break;case"lineStart":n=a?"command":"label";break;case"string":'"'===t&&(n="argument");break;case"variable":a?r?(r=!1,n="argument"):(n="command",s=""):p||(n="argument")}}return{lineStatus:n,startstring:o}}(e.getText(new i.Range(new i.Position(t.line,0),t)),t.character);this._document=e;let s=[];if(this._labelsReady&&"jumplabel"===n.lineStatus){const e=new i.Range(new i.Position(t.line,t.character-n.startstring.length),t);s=this._findLabel(n.startstring,s,e)}return s}_refreshLabelDB(){if(!o.existsSync(this._dbfile)){const e={labels:[{routine:"",label:""}],routines:{}};o.writeFileSync(this._dbfile,JSON.stringify(e))}o.readFile(this._dbfile,((e,t)=>{if(!e){this._labelDB=JSON.parse(t.toString());let e=!1;i.workspace.findFiles("*.m").then((t=>{this._filesToCheck=t.length;for(let n=0;n<t.length;n++){const i=t[n].fsPath;o.stat(i,((t,n)=>{if(t)this._checkReady(e);else{const t=this._labelDB.routines[i];void 0===t||n.mtimeMs>t?(this._labelDB.routines[i]=n.mtimeMs,e=!0,n.size<5e4?this._refreshFileLabels(i):this._checkReady(e)):this._checkReady(e)}}))}this._labelsReady=!0}))}}))}_checkReady(e){0==--this._filesToCheck&&e&&o.writeFile(this._dbfile,JSON.stringify(this._labelDB),(e=>{e&&i.window.showErrorMessage("Error writing Label DB")}))}_refreshFileLabels(e){var t;let n=e.replace(/\\\\/g,"/").split("/").pop();n=null!==(t=null==n?void 0:n.split(".")[0].replace("_","%"))&&void 0!==t?t:"",o.readFile(e,"utf8",((e,t)=>{if(!e){const e=t.split("\n");let i=null;this._labelDB.labels=this._labelDB.labels.filter((e=>e.routine!==n));for(let t=0;t<e.length;t++)n&&(0===t&&this._labelDB.labels.push({label:"*FL",routine:n,line:e[0]}),(i=e[t].match(/^[%A-Za-z0-9][A-Za-z0-9]{0,31}/))&&this._labelDB.labels.push({label:i[0],routine:n,line:e[t]}))}this._checkReady(!0)}))}_findLabel(e,t,n){let i=[];const o=s.getLabels(this._document.getText());let r="";if("^"===e.charAt(0)){const t=e.substring(1);i=this._labelDB.labels.filter((e=>e.routine.startsWith(t)))}else if(-1!==e.indexOf("^")){const t=e.split("^")[0],n=e.split("^")[1];i=this._labelDB.labels.filter((e=>e.label===t&&e.routine.startsWith(n)))}else{for(let t=0;t<o.length;t++)o[t].name.startsWith(e)&&i.push({routine:"",label:o[t].name,line:this._document.lineAt(o[t].line).text});i=i.concat(this._labelDB.labels.filter((t=>t.label.startsWith(e))))}for(let s=0;s<i.length&&s<100;s++){r="100";const o=i[s];let a=""!==o.routine?o.label+"^"+o.routine:o.label;if(a===e)continue;if("*FL"===o.label){if(!e.startsWith("^"))continue;a="^"+o.routine}let p="";"("===o.line.charAt(o.label.length)&&-1!==o.line.indexOf(")")&&(p=o.line.split(")")[0]+")"),-1!==o.line.indexOf(";")&&(p+=o.line.substring(o.line.indexOf(";")+1)),p.length>0&&(r="099"),""===o.routine&&(r="098"),t.push({label:a,detail:p,sortText:r,range:n})}return t}}},31:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496);t.default=class{resolveDebugConfiguration(e,t){if(!t.type&&!t.request&&!t.name){const e=i.window.activeTextEditor;e&&"mumps"===e.document.languageId&&(t.type="mumps",t.name="Launch",t.request="launch",t.program="${file}",t.stopOnEntry=!0,t.hostname="192.168.0.1",t.localRoutinesPath="y:\\",t.port=9e3)}return t.program?t:i.window.showInformationMessage("Cannot find a program to debug").then((()=>{}))}}},317:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{p(i.next(e))}catch(e){o(e)}}function a(e){try{p(i.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}p((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MumpsConnect=void 0;const s=n(808),o=n(361),r=n(147);var a;!function(e){e[e.disconnected=0]="disconnected",e[e.waitingforStart=1]="waitingforStart",e[e.waitingForVars=2]="waitingForVars",e[e.waitingForBreakpoints=3]="waitingForBreakpoints",e[e.waitingForSingleVar=4]="waitingForSingleVar",e[e.waitingForSingleVarContent=5]="waitingForSingleVarContent",e[e.waitingForErrorReport=6]="waitingForErrorReport",e[e.waitingForHints=7]="waitingForHints"}(a||(a={}));class p extends o.EventEmitter{constructor(){super(),this._socket=new s.Socket,this._event=new o.EventEmitter,this._currentLine=0,this._breakpointId=1,this._logging=!1,this._singleVar="",this._singleVarContent="",this._commandQueue=[],this._connectState=a.disconnected,this._readedData="",this._mVars={},this._mStack=[],this._activeBreakpoints=[],this._breakPoints=[],this._errorLines=[],this._singleVar="",this._singleVarContent="",this._hints=[],this._event.on("varsComplete",(()=>{if(void 0!==this._mVars.I){const e=this._mVars.I;this.checkEvents(e)}}))}init(e,t,n){return i(this,void 0,void 0,(function*(){return this._localRoutinesPath=n,this._hostname=e,this._port=t,new Promise(((e,t)=>{this._socket.connect(this._port,this._hostname,(()=>{this._log("Debug-Server connected\n"),this._connectState=a.waitingforStart,this._socket.on("data",(e=>{this._readedData+=e.toString();let t=this._readedData.indexOf("\n");for(;-1!==t;){const e=this._readedData.substring(0,t);this.processLine(e),this._readedData=this._readedData.substring(t+1),t=this._readedData.indexOf("\n")}})),e(this._socket)})),this._socket.on("error",(e=>{t(e)})),this._socket.on("end",(()=>{this._connectState=a.disconnected}))}))}))}_log(e){this._logging&&console.log(e)}processLine(e){let t,n,i;switch(this._log("Line:  "+e),this._connectState){case a.waitingforStart:if("***STARTVAR"===e){this._connectState=a.waitingForVars,this._mStack=[],this._mVars={};break}if("***STARTBP"===e){this._connectState=a.waitingForBreakpoints,this._activeBreakpoints=[],this._log(e);break}if("***SINGLEVAR"===e){this._connectState=a.waitingForSingleVar,this._singleVar="",this._singleVarContent="";break}if("***ENDPROGRAM"===e){this.sendEvent("end"),this._socket.end();break}if("***BEGINERRCHK"===e){this._connectState=a.waitingForErrorReport,this._errorLines=[];break}if("***STARTHINTS"===e){this._connectState=a.waitingForHints,this._hints=[];break}break;case a.waitingForVars:if("***ENDVAR"===e)this._connectState=a.waitingforStart,this._event.emit("varsComplete");else{for(i=e.substring(0,1),"S"===i&&this._mStack.push(e.substring(2)),t=e.substring(2,e.indexOf("="));(t.split('"').length-1)%2!=0;)t=e.substring(0,e.indexOf("=",t.length+1));n=e.substring(t.length+3).replace(/^"/,"").replace(/"$/,""),void 0===this._mVars[i]&&(this._mVars[i]={}),this._mVars[i][t]=n}break;case a.waitingForBreakpoints:"***ENDBP"===e?(this._log(e),this._connectState=a.waitingforStart,this.verifyBreakpoints()):(this._log(e),this._activeBreakpoints.push(e));break;case a.waitingForSingleVar:"***SINGLEEND"===e?(this._connectState=a.waitingforStart,this._event.emit("SingleVarReceived",this._event,this._singleVar,this._singleVarContent)):"***SINGLEVARCONTENT"===e?this._connectState=a.waitingForSingleVarContent:this._singleVar+=e;break;case a.waitingForSingleVarContent:"***SINGLEEND"===e?(this._connectState=a.waitingforStart,this._event.emit("SingleVarReceived",this._event,this._singleVar,this._singleVarContent)):this._singleVarContent+=e;break;case a.waitingForErrorReport:"***ENDERRCHK"===e?(this._connectState=a.waitingforStart,this._event.emit("ErrorreportReceived",this._event,this._errorLines)):this._errorLines.push(e);break;case a.waitingForHints:"***ENDHINTS"===e?(this._connectState=a.waitingforStart,this._event.emit("HintsReceived",this._event,this._hints)):this._hints.push(e);break;default:console.error("Unexpected Message: "+e)}}writeln(e){if(this._commandQueue.push(e),this._commandQueue.length>1e3)throw console.error("Too many Commands in Queue: Check Debugger Connection"),new Error;if(this._connectState!==a.disconnected)for(;this._commandQueue.length;){e=this._commandQueue.shift();try{this._socket.write(e+"\n")}catch(t){this._commandQueue.unshift(e);break}}}sendBreakpoint(e,t,n,i){void 0===i&&(i=""),n?this.writeln("SETBP;"+e+";"+t+";"+i):this.writeln("CLEARBP;"+e+";"+t)}start(e,t){t&&(e.indexOf("^")?this.sendBreakpoint(e,0,!0,""):this.sendBreakpoint(e,1,!0,"")),this.requestBreakpoints(),this.writeln("START;"+e)}step(e){this.writeln(e)}continue(){this.writeln("CONTINUE")}disconnect(){this.writeln("RESET"),this._socket.end()}requestBreakpoints(){this.writeln("REQUESTBP")}restart(e){this.writeln("RESTART;"+e)}checkEvents(e){const t=e.$ZPOSITION,n=e.$ZSTATUS,i=t.split("^"),s=i[0],o=i[1],r=this._localRoutinesPath+o+".m";this.loadSource(r);const a=s.split("+")[0];let p=0;void 0!==s.split("+")[1]&&(p=parseInt(s.split("+")[1]));let c=0;if(""!==a)for(let e=0;e<this._sourceLines.length;e++)if(this._sourceLines[e].substring(0,a.length)===a){c=e;break}this._currentLine=c+p,""!==n&&e.$ZTRAP===e.$ZSTEP?(this.sendEvent("stopOnException",n),this._log(n)):this._breakPoints.filter((e=>e.file===this._sourceFile&&e.line===this._currentLine)).length>0?this.sendEvent("stopOnBreakpoint"):this.sendEvent("stopOnStep")}stack(e,t){const n=new Array;for(let t=e;t<this._mStack.length;t++){const e=this._mStack[t];if(-1!==e.indexOf("^")){const i=this.convertMumpsPosition(e);n.push({index:t,name:`${e}(${t})`,file:i.file,line:i.line})}}return{frames:n,count:Math.min(n.length,t)}}setBreakPoint(e,t){const n=[];if(t)for(let i=0;i<t.length;i++){const s=t[i],o=s.line;n.push({id:this._breakpointId,verified:!1}),this._breakPoints.push({verified:!1,file:e,line:o,id:this._breakpointId++}),this.sendBreakpoint(e,o,!0,s.condition)}return n}clearBreakPoint(e,t){const n=this._breakPoints;if(n){const i=n.findIndex((n=>n.file===e&&n.line===t));if(i>=0){const t=n[i];return this.sendBreakpoint(e,t.line,!1),n.splice(i,1),t}}}clearBreakpoints(e){this.writeln("CLEARBP;"+e)}verifyBreakpoints(){const e=[];this._breakPoints.forEach((t=>{t.verified=!1;for(let n=0;n<this._activeBreakpoints.length;n++){const i=this.convertMumpsPosition(this._activeBreakpoints[n]);if(i.file=this.normalizeDrive(i.file.replace(/\\/g,"/")),t.file=this.normalizeDrive(t.file.replace(/\\/g,"/")),i.file===t.file&&t.line===i.line){t.verified=!0,this.sendEvent("breakpointValidated",t),e[n]=!0;break}}t.verified||this.sendEvent("breakpointValidated",t)}));for(let t=0;t<this._activeBreakpoints.length;t++)if(!e[t]){const e=this.convertMumpsPosition(this._activeBreakpoints[t]),n={verified:!0,file:e.file,line:e.line,id:this._breakpointId++};this.sendEvent("breakpointValidated",n)}}normalizeDrive(e){const t=e.split(":");return 2===t.length?t[0].toLowerCase()+":"+t[1]:e}getVariables(e){return"system"===e?this._mVars.I:"local"===e?this._mVars.V:void 0}checkRoutine(e){return i(this,void 0,void 0,(function*(){return new Promise((t=>{this._event.on("ErrorreportReceived",(function e(n,i){n.removeListener("ErrorreportReceived",e),t(i)})),this.writeln("ERRCHK");for(let t=0;t<e.length;t++)this.writeln(e[t]);this.writeln("***ENDPROGRAM")}))}))}getSingleVar(e){return i(this,void 0,void 0,(function*(){return new Promise((t=>{const n={name:e,indexCount:0,content:"undefined",bases:[]};let i="V";"$"===e.charAt(0)&&(i="I"),void 0!==this._mVars[i]?void 0!==this._mVars[i][e]?(n.content=this._mVars[i][e],t(n)):(this._event.on("SingleVarReceived",(function e(i,s,o){i.removeListener("SingleVarReceived",e),n.name=s,n.content=o,t(n)})),this.writeln("GETVAR;"+e)):t(n)}))}))}loadSource(e){if(e=e.replace(/%/g,"_"),this._sourceFile!==e){this._sourceFile=e;try{this._sourceLines=(0,r.readFileSync)(this._sourceFile).toString().split("\n")}catch(t){console.log("Could not read Sourcefile "+e)}}}convertMumpsPosition(e){const t=e.split("^"),n=t[0];if(void 0===t[1])return{file:"",line:1};{const e=t[1].split(" ",1)[0],i=(this._localRoutinesPath+e+".m").replace(/%/g,"_");try{const e=(0,r.readFileSync)(i).toString().split("\n"),t=n.split("+")[0],s=new RegExp("^"+t+"[(\\s;]");let o=0;void 0!==n.split("+")[1]&&(o=parseInt(n.split("+")[1]));let a=0;if(""!==t)for(let t=0;t<e.length;t++)if(e[t].match(s)){a=t;break}return{file:i,line:a+o}}catch(e){return console.log("Could not read Sourcefile "+i),{file:i,line:1}}}}sendEvent(e,...t){this.emit(e,...t)}}t.MumpsConnect=p},223:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{p(i.next(e))}catch(e){o(e)}}function a(e){try{p(i.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}p((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(955),o=n(17),r=n(29),a=n(317),p=n(496),c=n(147),l=p.languages.createDiagnosticCollection("mumps");class u extends s.DebugSession{constructor(){super(),this._variableHandles=new s.Handles,this._variableBases={},this._configurationDone=new r.Subject,this._localScope=this._variableHandles.create("~local|0"),this._systemScope=this._variableHandles.create("~system"),this.setDebuggerLinesStartAt1(!1),this.setDebuggerColumnsStartAt1(!1),this._program="",this._mconnect=new a.MumpsConnect,this._mconnect.on("stopOnEntry",(()=>{this.sendEvent(new s.StoppedEvent("entry",u.THREAD_ID))})),this._mconnect.on("stopOnStep",(()=>{this.sendEvent(new s.StoppedEvent("step",u.THREAD_ID))})),this._mconnect.on("stopOnBreakpoint",(()=>{this.sendEvent(new s.StoppedEvent("breakpoint",u.THREAD_ID))})),this._mconnect.on("stopOnDataBreakpoint",(()=>{this.sendEvent(new s.StoppedEvent("data breakpoint",u.THREAD_ID))})),this._mconnect.on("stopOnException",(()=>{this.sendEvent(new s.StoppedEvent("exception",u.THREAD_ID))})),this._mconnect.on("breakpointValidated",(e=>{this.sendEvent(new s.BreakpointEvent("changed",{verified:e.verified,id:e.id}))})),this._mconnect.on("end",(()=>{this.sendEvent(new s.TerminatedEvent)}))}initializeRequest(e){e.body=e.body||{},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsDataBreakpoints=!1,e.body.supportsConditionalBreakpoints=!0,e.body.supportsCompletionsRequest=!1,e.body.completionTriggerCharacters=[".","["],e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!0,e.body.supportsExceptionInfoRequest=!0,e.body.supportsRestartRequest=!0,this.sendResponse(e),this.sendEvent(new s.InitializedEvent)}configurationDoneRequest(e,t){super.configurationDoneRequest(e,t),this._configurationDone.notify()}launchRequest(e,t){return i(this,void 0,void 0,(function*(){yield this._configurationDone.wait(1e3),this._mconnect.init(t.hostname,t.port,t.localRoutinesPath).then((()=>i(this,void 0,void 0,(function*(){var n;this.refreshDiagnostics(null===(n=p.window.activeTextEditor)||void 0===n?void 0:n.document,l),this._mconnect.start(t.program,!!t.stopOnEntry),this._program=t.program,this.sendResponse(e)})))).catch((()=>{p.window.showErrorMessage("Connection to MDEBUG failed. \nPlease start MDEBUG first.")}))}))}setBreakPointsRequest(e,t){const n=t.source.path;this._mconnect.clearBreakpoints(n);const i=this._mconnect.setBreakPoint(n,t.breakpoints);e.body={breakpoints:i},this.sendResponse(e),this._mconnect.requestBreakpoints()}threadsRequest(e){e.body={threads:[new s.Thread(u.THREAD_ID,"thread 1")]},this.sendResponse(e)}stackTraceRequest(e,t){const n="number"==typeof t.startFrame?t.startFrame:0,i=n+("number"==typeof t.levels?t.levels:1e3),o=this._mconnect.stack(n,i);e.body={stackFrames:o.frames.map((e=>new s.StackFrame(e.index,e.name,this.createSource(e.file),this.convertDebuggerLineToClient(e.line)))),totalFrames:o.count},0===o.count&&this.sendEvent(new s.TerminatedEvent),this.sendResponse(e)}scopesRequest(e){e.body={scopes:[new s.Scope("Local",this._localScope,!1),new s.Scope("System",this._systemScope,!1)]},this.sendResponse(e)}variablesRequest(e,t){return i(this,void 0,void 0,(function*(){const n=[];let i;const s=t.variablesReference,o=this._variableHandles.get(t.variablesReference);if(s===this._systemScope){const e=this._mconnect.getVariables("system");for(const t in e)n.push({name:t,type:"string",value:e[t],variablesReference:0})}else{const e=o.split("|"),t=parseInt(e.pop()||"0"),s=e.join("|"),r=this._mconnect.getVariables("local");let a,p="";for(const e in r){const o=this.varAnalyze(e,r[e]);void 0!==a?((i=this._checkVars(a,o,t,s,p))&&(0!==i.variablesReference&&(p=a.bases[t]),n.push(i)),a=o):a=o}if(void 0!==a){const e={name:"",indexCount:0,bases:[],content:""},i=this._checkVars(a,e,t,s,p);i&&n.push(i)}}e.body={variables:n},this.sendResponse(e)}))}_checkVars(e,t,n,i,s){let o,r=0;if(0===n||e.bases[n-1]===i&&e.indexCount>n)if(e.indexCount>n+1){if(s!==e.bases[n]){let t=e.bases[n];n>0&&(t+=")"),void 0===this._variableBases[e.bases[n]]&&(this._variableBases[e.bases[n]]=this._variableHandles.create(e.bases[n]+"|"+(n+1))),o={name:t,type:"string",value:"undefined",variablesReference:this._variableBases[e.bases[n]]}}}else e.bases[n]===t.bases[n]&&(void 0===this._variableBases[e.bases[n]]&&(this._variableBases[e.bases[n]]=this._variableHandles.create(e.bases[n]+"|"+(n+1))),r=this._variableBases[e.bases[n]]),o={name:e.name,type:"string",value:e.content,variablesReference:r};return o}continueRequest(e){this._mconnect.continue(),this.sendResponse(e)}nextRequest(e){this._mconnect.step("OVER"),this.sendResponse(e)}stepInRequest(e){this._mconnect.step("INTO"),this.sendResponse(e)}stepOutRequest(e){this._mconnect.step("OUTOF"),this.sendResponse(e)}evaluateRequest(e,t){return i(this,void 0,void 0,(function*(){"hover"!==t.context&&"repl"!==t.context||this._mconnect.getSingleVar(t.expression).then((n=>{e.body={result:n.name+" := "+n.content,variablesReference:0},t.expression.includes(")")||void 0===this._variableBases[t.expression]||(e.body.variablesReference=this._variableBases[t.expression]),this.sendResponse(e)}))}))}restartRequest(e){return i(this,void 0,void 0,(function*(){const t=(0,c.readFileSync)(this._program).toString().split("\n");this._mconnect.checkRoutine(t).then((e=>{e.length?p.window.showErrorMessage("File contains Problems - No Restart possible!"):this._mconnect.restart(this._program)})),this.sendResponse(e)}))}disconnectRequest(e){this._mconnect.disconnect(),this.sendResponse(e)}createSource(e){return new s.Source((0,o.basename)(e),this.convertDebuggerPathToClient(e),void 0,void 0,"mumps-adapter-data")}exceptionInfoRequest(e){return i(this,void 0,void 0,(function*(){const t=yield this._mconnect.getSingleVar("$ZSTATUS"),n=t.content.split(","),i=n[0].length+n[1].length+n[2].length+4,s=t.content.substr(i);e.body={exceptionId:n[2],description:s,breakMode:"always",details:{message:"Line :"+n[1],typeName:"ErrorException"}},this.sendResponse(e)}))}varAnalyze(e,t){let n=1;const i=[],s=e.length,o=e.indexOf("(");let r=!0;if(o>0){i.push(e.substring(0,o)),n++;for(let t=o;t<s;t++)","===e.substring(t,t+1)&&r&&(i.push(e.substring(0,t)),n++),'"'===e.substring(t,t+1)&&(r=!r);i.push(e.substring(0,e.length-1))}else i.push(e);return{name:e,indexCount:n,bases:i,content:t}}refreshDiagnostics(e,t){const n=[];if(e){const i=e.getText().split("\n");this._mconnect.checkRoutine(i).then((i=>{for(let t=0;t<i.length;t++){const s=i[t].split(";");let o=parseInt(s[0])-1;isNaN(o)&&(o=0);let r=parseInt(s[1])-1;isNaN(r)&&(r=0);let a=e.lineAt(r).text.length;0===r&&0===o&&(a=0);const c=s[2],l=new p.Range(r,o,r,a),u=new p.Diagnostic(l,c,p.DiagnosticSeverity.Error);u.code=c,n.push(u)}t.clear(),t.set(e.uri,n)}))}}}u.THREAD_ID=1,t.default=u},385:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(964);t.default=class{provideDefinition(e,t){return new i.MumpsTokenHelper(e,t).getTokenRefLocation()}}},289:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s=n(105),o=new s.MumpsLineParser,r=[];t.default=class{constructor(e,t){this._linetokens=[],this._diags=[],this._variablesToBeIgnored=[],this._enableVariableCheck=!0,this._subroutines=[],this._routine={startLine:-1,endLine:-1,parameters:[]},this._level=0,this._lineWithDo=-2,this._isBehindQuit=!1,this._startUnreachable=!1,this._activeSubroutine={name:"",startLine:-1,endLine:-1},this._document=e,this._diags=[],this._linetokens=[];const n=i.workspace.getConfiguration();if(void 0!==n.mumps.variablesToBeIgnoredAtNewCheck&&(this._variablesToBeIgnored=n.mumps.variablesToBeIgnoredAtNewCheck.split(",")),void 0!==n.mumps.enableVariableCheck&&(this._enableVariableCheck=n.mumps.enableVariableCheck),e&&"mumps"===e.languageId){t.clear();for(let t=0;t<e.lineCount;t++){const n=e.lineAt(t),s=o.analyzeLine(n.text);""!==s.error.text&&this._addWarning(s.error.text,t,s.error.position,-1,i.DiagnosticSeverity.Error),this._linetokens.push(s.tokens),this._checkLine(t,s.tokens)}this._activeSubroutine.startLine>-1&&this._addSymbol(this._activeSubroutine.name,this._activeSubroutine.startLine,this._linetokens.length);for(let e=0;e<this._subroutines.length;e++)this.analyzeSubroutine(this._subroutines[e]);this._diags&&t.set(e.uri,this._diags)}}analyzeSubroutine(e){if(this._enableVariableCheck){this._varStates={},this._levelExclusiveNew=[];let t=0;for(let t=0;t<e.parameters.length;t++)this._varStates[e.parameters[t].name]={isParameter:!0,parameterPosition:e.parameters[t].position};for(let n=e.startLine;n<=e.endLine;n++){let i=!1;for(let o=0;o<this._linetokens[n].length;o++){let r=this._linetokens[n][o];if(n===e.startLine&&0===o){for(;++o<this._linetokens[n].length&&this._linetokens[n][o].type===s.TokenType.local;);if(!(o<this._linetokens[n].length))continue;r=this._linetokens[n][o]}if(r.type===s.TokenType.intendation){i=!0;const e=r.name.length;e<t&&this._reduceIntendationLevel(t,e),t=e}else r.type===s.TokenType.comment&&!i&&t>0&&(this._reduceIntendationLevel(t,0),t=0);if(r.type===s.TokenType.keyword){if(!i&&t>0&&(this._reduceIntendationLevel(t,0),t=0),"NEW"===r.longName){let i=!1,a=!1;for(;++o<this._linetokens[n].length&&(this._linetokens[n][o].type===s.TokenType.local||this._linetokens[n][o].type===s.TokenType.sysvariable);)if(i=!0,r=this._linetokens[n][o],r.isExcludedVariable&&(a=!0),r.type===s.TokenType.local){const e=r.name;let i="";const s=this._varStates[e]?this._varStates[e]:{isExcluded:r.isExcludedVariable};s.isParameter?r.isExcludedVariable?s.isExcluded=!0:0===t&&(i="NEW hides formal parameter "+e):s.newedAtLevel?s.newedAtLevel.indexOf(t)>-1?i="Variable "+e+" already mentioned in NEW command":(s.newedAtLevel.push(t),s.newedAtLine.push(n),s.newedAtPostion.push(r.position)):(s.newedAtLevel=[t],s.newedAtLine=[n],s.newedAtPostion=[r.position]),""!==i&&this._addWarning(i,n,r.position,r.name.length),this._varStates[e]=s}if(!1===i&&(a=!0),a&&this._levelExclusiveNew.push(t),e.parameters.length>0&&a&&0===t)for(let t=0;t<e.parameters.length;t++)if(!this._varStates[e.parameters[t].name].isExcluded){this._addWarning("NEW hides formal parameters",n,r.position,r.name.length);break}}}else if(r.type===s.TokenType.local){const e=r.name;this._checkNewed(e,t,n,r.position)}}}this._checkVariableUsage(e)}}_checkVariableUsage(e){for(const t in this._varStates){const n=this._varStates[t];!n.isParameter||n.isUsed||this._isIgnoredVariable(t)?n.newedAtLine&&n.newedAtLine.length>0&&!n.isUsed&&!this._isIgnoredVariable(t)&&this._addWarning("Variable "+t+" is NEWed but not used",n.newedAtLine[0],n.newedAtPostion[0],t.length):this._addWarning("Variable "+t+" is a formal parameter but not used",e.startLine,n.parameterPosition,t.length)}}_checkNewed(e,t,n,i){let s=this._varStates[e];if(!this._isIgnoredVariable(e)){let o=!1;for(let e=0;e<this._levelExclusiveNew.length;e++)this._levelExclusiveNew[e]<=t&&(o=!0);if(!o&&s){if(s.isParameter)o=!0;else if(s.newedAtLevel)for(let e=0;e<s.newedAtLevel.length;e++)if(s.newedAtLevel[e]<=t){o=!0;break}s.isUsed=!0}o||this._addWarning("Variable "+e+" not NEWed",n,i,e.length)}s?s.isUsed=!0:s={isUsed:!0},this._varStates[e]=s}_addWarning(e,t,n,s,o){void 0===o&&(o=i.DiagnosticSeverity.Warning);let r=t,a=n+s;-1===s&&(r=t+1,a=0),this._diags.push({code:"",message:e,range:new i.Range(new i.Position(t,n),new i.Position(r,a)),severity:o,source:""})}_checkLine(e,t){let n=!1,o=!1;0===t.length&&(e===this._lineWithDo+1&&(this._addWarning("Expected intendation level: "+(this._level+1)+", found: 0",e,0,1),this._lineWithDo=-2),this._level=0);for(let r=0;r<t.length;r++){let a=t[r];if(a.type===s.TokenType.comment&&a.name.match(/ignoreVars:/)&&(this._variablesToBeIgnored=this._variablesToBeIgnored.concat(a.name.split("ignoreVars:")[1].split(","))),0===r&&a.type===s.TokenType.label&&(this._activeSubroutine.startLine>-1&&this._addSymbol(this._activeSubroutine.name,this._activeSubroutine.startLine,e),this._activeSubroutine.startLine=e,this._activeSubroutine.name=a.name,this._isBehindQuit=!1,this._startUnreachable&&(this._diags.push({code:"",message:"Unreachable Code",range:new i.Range(this._startUnreachable,new i.Position(e,0)),severity:i.DiagnosticSeverity.Warning,source:""}),this._startUnreachable=!1),void 0!==t[1]&&t[1].type===s.TokenType.local)){for(this._routine.startLine=e;++r<t.length&&t[r].type===s.TokenType.local;)this._routine.parameters.push({name:t[r].name,position:t[r].position});if(r>=t.length)continue;a=t[r]}if(a.type!==s.TokenType.keyword&&a.type!==s.TokenType.comment||!1===o&&(e===this._lineWithDo+1&&(this._addWarning("Expected intendation level: "+(this._level+1)+", found: "+this._level,e,0,a.position),this._lineWithDo=-2),this._level=0),a.type===s.TokenType.keyword){this._isBehindQuit&&!1===this._startUnreachable&&(this._startUnreachable=new i.Position(e,a.position));const o=a.longName;if("IF"!==o&&"ELSE"!==o||(n=!0),"DO"===o&&!1===a.hasArguments&&(this._lineWithDo=e),!(n||"QUIT"!==o&&"GOTO"!==o&&"HALT"!==o||a.isPostconditioned||0!==this._level)){let n=!1;if("GOTO"===o)for(let e=r+1;e<t.length;e++){if(t[e].type===s.TokenType.argPostcondition){n=!0;break}if(t[e].type===s.TokenType.keyword)break}if(!n){this._routine.endLine=e,-1!==this._routine.startLine&&(this._subroutines.push(this._routine),this._routine={startLine:-1,endLine:-1,parameters:[]}),this._isBehindQuit=!0;break}}}if(a.type===s.TokenType.intendation){const t=e===this._lineWithDo+1?this._level+1:this._level;this._level=a.name.length,o=!0,this._level>t&&this._addWarning("Intendation Level wrong, found: "+this._level+", expected: "+t,e,0,a.position),e===this._lineWithDo+1&&this._level<t&&this._addWarning("Higher intendation expected after argumentless Do",e,0,a.position),this._lineWithDo=-2}}}_isIgnoredVariable(e){let t=!1;for(let n=0;n<this._variablesToBeIgnored.length;n++)if(new RegExp("^"+this._variablesToBeIgnored[n]+"$").test(e)){t=!0;break}return t}_reduceIntendationLevel(e,t){var n;for(let n=t+1;n<=e;n++){const e=this._levelExclusiveNew.indexOf(n);e>-1&&this._levelExclusiveNew.splice(e,1)}for(const i in this._varStates){const s=this._varStates[i];let o=!1,r=0,a=0;if(s.newedAtLevel){for(let p=t+1;p<=e;p++){const e=null===(n=s.newedAtLevel)||void 0===n?void 0:n.indexOf(p);e>-1&&(r=s.newedAtLine[e],a=s.newedAtPostion[e],s.newedAtLevel.splice(e,1),s.newedAtLine.splice(e,1),s.newedAtPostion.splice(e,1),o=!0,this._varStates[i]=s)}o&&!s.isUsed&&this._addWarning("Variable "+i+" is NEWed but not used",r,a,i.length)}}}_addSymbol(e,t,n){const s=new i.Position(t,0),o=new i.Position(n,0),a=new i.Location(this._document.uri,new i.Range(s,o));r.push(new i.SymbolInformation(e,i.SymbolKind.Function,"",a))}}},806:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s=new(n(105).MumpsLineParser);t.default=class{provideDocumentSymbols(e){return new Promise((t=>{const n=s.getLabels(e.getText()),o=[];for(let t=0;t<n.length;t++){const s=new i.Position(n[t].line,0);let r=e.lineCount-1;void 0!==n[t+1]&&(r=n[t+1].line);const a=new i.Position(r,0),p=new i.Location(e.uri,new i.Range(s,a));o.push(new i.SymbolInformation(n[t].name,i.SymbolKind.Function,"",p))}t(o)}))}}},938:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s="\t;****************\n";function o(e){let t="",n=[];t+=s,t+="\t; DESCRIPTION: \n";const i=e.match(/\(.*\)/);return null!==i&&i.length>0&&(n=i[0].toString().substring(1,i[0].toString().length-1).split(","),n.length>0&&(t+="\t; PARAMETERS: \n",n.forEach((function(e){t+="\t;    "+e+": \n"})))),t+="\t; RETURNS: \n",t+="\t; REVISIONS: \n",t+=s,t}t.default=function(){const e=i.window.activeTextEditor;if(e){const t=e.document;let n=e.selection.start.with(e.selection.start.line,0);for(;n.line<t.lineCount&&""===e.document.lineAt(n.line).text.replace(/\t| /gi,"");)n=n.translate(1,0);for(n.line===t.lineCount&&(n=n.translate(-1,0));n.line>=0;){const t=e.document.lineAt(n.line).text;if(0!==t.length&&" "!==t.charAt(0)&&"\t"!==t.charAt(0)&&";"!==t.charAt(0)){e.edit((e=>{e.insert(n,o(t))}));break}n=n.translate(-1,0)}}}},766:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496);t.default=class{provideEvaluatableExpression(e,t){const n=e.lineAt(t.line).text;if(")"===n.charAt(t.character))return this.getExpression(t.line,n.substring(0,t.character));let s=null;const o=/([ (.,+\-*_:=])([\^$]?%?[a-zA-Z][a-zA-Z\d]*)/g;for(;s=o.exec(n);){let e=s.index;e+=s[0].length-s[2].length;const n=e+s[2].length-1;if(e<=t.character&&n>=t.character)return new i.EvaluatableExpression(new i.Range(t.line,e,t.line,n),s[2])}}getExpression(e,t){let n=!1;for(let e=0;e<t.length;e++)'"'===t.charAt(e)&&(n=!n);if(n)return;let s=1,o=0;for(let e=t.length-1;e>-1;e--){const i=t.charAt(e);if('"'===i&&(n=!n),"("===i&&!n&&(s--,0===s)){o=e;break}")"!==i||n||s++}if(0===s){const n=/([ (,+\-*_:=])([\^$]?%?[a-zA-Z][a-zA-Z\d]*)$/,s=t.substring(0,o).match(n);if(s)return new i.EvaluatableExpression(new i.Range(e,o-s[2].length,e,t.length+1))}}}},185:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496);function s(e,t,n){if(0===e.replace(/( |\t)/gi,"").length&&n.push(i.TextEdit.insert(new i.Position(t,0),"\t;")),(e.endsWith(". ")||e.endsWith("."))&&n.push(i.TextEdit.insert(new i.Position(t,e.length),";")),e.startsWith(" ")){let s;for(s=0;s<e.length&&" "===e.charAt(s);s++);n.push(i.TextEdit.replace(new i.Range(new i.Position(t,0),new i.Position(t,s)),"\t"))}if(e.match(/^([A-Za-z%][A-Za-z0-9]*(\([A-Za-z%][A-Za-z0-9]*(,[A-Za-z%][A-Za-z0-9]*)*\))?)?[\t ]+\./)){let s=". ";const o=e.indexOf(".");let r=1,a=0,p="";do{p=e.charAt(r+a+o)," "===p?a++:"."===p&&(r++,s+=". ")}while("."===p||" "===p);r!==a&&n.push(i.TextEdit.replace(new i.Range(new i.Position(t,o),new i.Position(t,o+r+a)),s))}}t.default=class{provideDocumentFormattingEdits(e){const t=[];for(let n=0;n<e.lineCount;n++)s(e.lineAt(n).text,n,t);return t}provideDocumentRangeFormattingEdits(e,t){const n=[];for(let i=t.start.line;i<=t.end.line;i++)s(e.lineAt(i).text,i,n);return n}}},64:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticTokens=t.MumpsHighlighter=void 0;const i=n(496),s=n(105),o=Object.keys(s.TokenType).map((e=>s.TokenType[e])),r=new i.SemanticTokensLegend(o,["standard"]);t.SemanticTokens=r;const a=new s.MumpsLineParser,p={provideDocumentSemanticTokens(e){const t=e.getText(),n=a.analyzeLines(t),o=new i.SemanticTokensBuilder(r);for(let e=0;e<n.length;e++){const t=n[e];for(let n=0;n<t.length;n++){const r=t[n],a=r.type;a===s.TokenType.exfunction&&(r.position-=2,r.name="$$"+r.name),r.position<0&&console.log(t),o.push(new i.Range(new i.Position(e,r.position),new i.Position(e,r.position+r.name.length)),s.TokenType[a],["standard"])}}return o.build()}};t.MumpsHighlighter=p},971:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(964);t.default=class{provideHover(e,t){return new i.MumpsTokenHelper(e,t).getTokenHoverInfo()}}},105:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MumpsLineParser=t.isv=t.ifunction=t.TokenType=void 0;const i=n(147);var s;!function(e){e[e.global=0]="global",e[e.local=1]="local",e[e.exfunction=2]="exfunction",e[e.nonMfunction=3]="nonMfunction",e[e.entryref=4]="entryref",e[e.operator=5]="operator",e[e.keyword=6]="keyword",e[e.ifunction=7]="ifunction",e[e.label=8]="label",e[e.comment=9]="comment",e[e.sysvariable=10]="sysvariable",e[e.string=11]="string",e[e.number=12]="number",e[e.intendation=13]="intendation",e[e.argPostcondition=14]="argPostcondition"}(s||(t.TokenType=s={}));const o=/^[A-Za-z%][A-Za-z0-9]*(\([A-Za-z%][A-Za-z0-9]*(,[A-Za-z%][A-Za-z0-9]*)*\))?/,r=/^[A-Za-z%][A-Za-z0-9]*/,a=/^\^[A-Za-z%][A-Za-z0-9]*/,p=/^\$(DEVICE|ECODE|EC|ESTACK|ES|ETRAP|ET|HALT|HOROLOG|H|IO|I|JOB|J|KEY|K|NAMESPACE|PRINCIPAL|P|QUIT|Q|REFERENCE|R|STACK|ST|STORAGE|S|SYSTEM|TEST|THIS|TLEVEL|TL|T|USERNAME|X|Y|ZALLOCSTOR|ZA|ZB|ZCHSET|ZCLOSE|ZCMDLINE|ZCM|ZCOMPILE|ZCO|ZCSTATUS|ZCH[A-Z]*|ZC|ZDATEFORM|ZDA|ZDIRECTORY|ZD|ZEDITOR|ZED|ZEOF|ZEO|ZE[A-Z]*|ZGBLDIR|ZG|ZHRORLOG|ZH|ZININTERRUPT|ZINI|ZINTERRUPT|ZINT|ZIO|ZJOB|ZJ|ZKEY|ZLEVEL|ZL|ZMAXTPTIME|ZMAXTPTI|ZMODE|ZMO|ZONLNRLBK|ZPATNUMERIC|ZPATN|ZPIN|ZPOSITION|ZPOS|ZPOUT|ZPROMPT|ZQUIT|ZREALSTOR|ZRELDATE|ZRO[A-Z]*|ZSOURCE|ZSO|ZSTA[A-Z]*|ZSTEP|ZSTRP|ZSTRPLLIM|ZST|ZSYSTEM|ZSY|ZS|ZTEXIT|ZTE|ZTIMEOUT|ZTIM|ZTRAP|ZT|ZUSEDSTOR|ZUT|ZVERSION|ZV[A-Z]*|ZYERROR|ZYRELEASE|ZTDATA|ZTDELIM|ZTLEVEL|ZTNAME|ZTOLDVAL|ZTRIGGEROP|ZTSLATE|ZTUPDATE|ZTVALUE|ZTWORMHOLE)/i;t.isv=p;const c=/^\$(ASCII|A|CHAR|C|DATA|D|EXTRACT|E|FIND|F|FNUMBER|FN|GET|G|INCREMENT|INCR|I|JUSTIFY|J|LENGTH|L|NAME|NA|NEXT|N|ORDER|O|PIECE|P|QLENGTH|QL|QSUBSCRIPT|QS|QUERY|Q|RANDOM|R|REVERSE|RE|SELECT|S|STACK|ST|TEXT|T|TRANSLATE|TR|VIEW|V|ZAHANDLE|ZAH|ZASCII|ZATRANSFORM|ZAT|ZBITAND|ZBITCOUNT|ZBITFIND|ZBITGET|ZBITLEN|ZBITNOT|ZBITOR|ZBITSET|ZBITSTR|ZBITXOR|ZCHAR|ZCH|ZCOLLATE|ZCONVERT|ZCO|ZDATE|ZDATA|ZD|ZEXTRACT|ZE|ZFIND|ZF|ZGETJPI|ZG|ZINCREMENT|ZINCR|ZJOBEXAM|ZJUSTIFY|ZJ|ZLENGTH|ZL|ZMESSAGE|ZPARSE|ZPEEK|ZPIECE|ZPI|ZPREVIOUS|ZP|ZQGBLMOD|ZSEARCH|ZSIGPROC|ZSOCKET|ZSUBSTR|ZSUB|ZSYSLOG|ZTRANSLATE|ZTRIGGER|ZTRI|ZTRNLNM|ZTR|ZWIDTH|ZWRITE|ZW)(?=\()/i;t.ifunction=c;const l=/^\$&([A-Za-z%0-9][A-Za-z0-9]*\.)?([A-Za-z%0-9][A-Za-z0-9]*)(\^[A-Za-z%][A-Za-z0-9]*)?/,u=/^(&[A-Za-z0-9]*\.?)?@?([A-Za-z%0-9][A-Za-z0-9]*)?(\^@?[A-Za-z%][A-Za-z0-9]*)?/,h=/^\^@?[A-Za-z%][A-Za-z0-9]*/,d=/^(\d*\.?\d*(E-?\d+)?)/,m=/^"(""|[^"])*"/,g=/^[B|BREAK|C|CLOSE|D|DO|E|ELSE|F|FOR|G|GOTO|H|HALT|HANG|I|IF|J|JOB|K|KILL|L|LOCK|M|MERGE|N|NEW|O|OPEN|Q|QUIT|R|READ|S|SET|U|USE|V|VIEW|W|WRITE|X|XECUTE|ZA|ZALLOCATE|ZBR|ZBREAK|ZC|ZCONTINUE|ZD|ZDEALLOCATE|ZE|ZEDIT|ZG|ZGOTO|ZHALT|ZH|ZHELP|ZK|ZKILL|ZL|ZLINK|ZM|ZMESSAGE|ZP|ZPRINT|ZRUPDATE|ZSH|ZSHOW|ZST|ZSTEP|ZSY|ZSYSTEM|ZTC|ZTCOMMIT|ZTR|ZTRIGGER|ZTS|ZTSTART|ZWI|ZWITHDRAW|ZWR|ZWRITE]/i,b=/^('=|'>|'<|<=|>=|'&|'!|'\?|'\[|'\]|\*\*|\+|-|\*|\/|\\|#|'|&|!|_|<|>|=|\[|\]\]|\]|\?|@)/,f=/(-|'|\+|@)/,E=/^([A|C|E|L|N|P|U]|^("([^"]("")*)*"))+/i,v=/^\d*\.?\d*/,T=/^APPEND|ATTACH=|BLOCK(SIZE)?=|COMMAND=|CONNECT=|(NO)?DELIM(ITER)?=?|EXC(EPTION)?=|FIFO|(NO)?FIXED|GROUP=|[IO]?CHSET=|KEY|IKEY|INDEPENDANT|IOERROR=|NEW[A-Z]*|MOREREADTIME=|OKEY|OWNER=|(NO)?RCHK|(NO)?READ(ONLY)?|RECORD(SIZE)?=|(NO)?RETRY|REWIND|SEEK=|SHELL=|STDERR=|(NO)?STREAM|SYSTEM=|(NO)?TRUNCATE|UIC=|VARIABLE|WORLD=|Z?(NO)?WRAP|WRITE(ONLY)?|ZBFSIZE=|Z(NO)?DELAY|Z(NO)?FF|ZIBFSIZE=|Z?LISTEN=/i,y=/^ATTACH|(NO)?CENABLE|[IO]?CHSET=|CLEAR(SCREEN)?|CONNECT|(NO)?CONVERT|CTRAP=|(NO)?DELIM(ITER)?=?|DETACH|DOWNSCROLL|(NO)?ECHO|(NO)?EDITING|ERASELINE|(NO)?ESC(APE)?|EXC(EPTION)?=|(NO)?FILTER=?|FLUSH|GROUP=|KEY|IKEY|IOERROR=|OKEY|OWNER=|(NO)?PASTHRU|(NO)?RCHK|(NO)?RETRY|REWIND|SEEK=|SKIPFILE=|SOCKET=|SPACE=|TERM(INATOR)?=|(NO)?TRUNCATE|(NO)?TTSNYC|(NO)?TYPEAHEAD|UPSCROLL|Z?LENGTH=|Z?WIDTH=|Z?(NO)?WRAP|WRITELB=|X=|Y=|ZBFSIZE|Z(NO)?DELAY|Z(NO)?FF|ZIBFSIZE|LISTEN=/i,R=/^DELETE|(NO)?DESTROY|EXCEPTION=|GROUP=|OWNER=|RENAME=|SOCKET=|TIMEOUT=|UIC=|WORLD=/i,_=/^CMD=|CMDLINE=|DEF=|DEFAULT=|ERR=|ERROR=|GBL=|GBLDIR=|IN=|INPUT=|OUT=|OUTPUT=|PASS|PASSCURLVN|STA=|STARTUP=/i,x=/^SERIAL|S|T=|TRANSACTIONID=/i,S={B:"BREAK",C:"CLOSE",D:"DO",E:"ELSE",F:"FOR",G:"GOTO",H:"HALT",I:"IF",J:"JOB",K:"KILL",L:"LOCK",M:"MERGE",N:"NEW",O:"OPEN",Q:"QUIT",R:"READ",S:"SET",U:"USE",V:"VIEW",W:"WRITE",X:"XECUTE",ZA:"ZALLOCATE",ZB:"ZBREAK",ZC:"ZCONTINUE",ZD:"ZDEALLOCATE",ZED:"ZEDIT",ZG:"ZGOTO",ZH:"ZHELP",ZK:"ZKILL",ZL:"ZLINK",ZM:"ZMESSAGE",ZP:"ZPRINT",ZSH:"ZSHOW",ZST:"ZSTEP",ZSY:"ZSYSTEM",ZTC:"ZTCOMMIT",ZTR:"ZTRIGGER",ZTS:"ZTSTART",ZWI:"ZWITHDRAW",ZWR:"ZWRITE"},A={A:"ASCII",C:"CHAR",D:"DATA",E:"EXTRACT",F:"FIND",FN:"FNUMBER",G:"GET",I:"INCREMENT",J:"JUSTIFY",L:"LENGTH",NA:"NAME",N:"NEXT",O:"ORDER",P:"PIECE",QL:"QLENGTH",QS:"QSUBSCRIPT",Q:"QUERY",R:"RANDOM",RE:"REVERSE",S:"SELECT",ST:"STACK",T:"TEXT",TR:"TRANSLATE",V:"VIEW",ZA:"ZASCII",ZAH:"ZAHANDLE",ZCO:"ZCONVERT",ZD:"ZDATE",ZE:"ZEXTRACT",ZF:"ZFIND",ZG:"ZGETJPI",ZJ:"ZJUSTIFY",ZL:"ZLENGTH",ZM:"ZMESSAGE",ZPI:"ZPIECE",ZP:"ZPREVIOUS",ZSUB:"ZSUBSTR",ZTR:"ZTRANSLATE",ZTRI:"ZTRIGGER",ZW:"ZWIDTH"},Z={D:"DEVICE",EC:"ECODE",ES:"ESTACK",ET:"ETRAP",H:"HOROLOG",I:"IO",J:"JOB",K:"KEY",P:"PRINCIPAL",Q:"QUIT",R:"REFERENCE",ST:"STACK",S:"STORAGE",SY:"SYSTEM",T:"TEST",TL:"TLEVEL",TR:"TRESTART",ZC:"ZCSTATUS",ZDA:"ZDATEFORM",ZD:"ZDIRECTORY",ZED:"ZEDITOR",ZEO:"ZEOF",ZE:"ZERROR",ZG:"ZGBLDIR",ZH:"ZHRORLOG",ZINI:"ZININTERRUPT",ZINT:"ZINTERRUPT",ZJ:"ZJOB",ZL:"ZLEVEL",ZMAXPTI:"ZMAXTPTIME",ZMO:"ZMODE",ZPOS:"ZPOSITION",ZPROM:"ZPROMPT",ZRO:"ZROUTINES",ZSO:"ZSOURCE",ZS:"ZSTATUS",ZST:"ZSTEP",ZSTRP:"ZSTRPLLIM",ZSY:"ZSYSTEM",ZTE:"ZTEXIT",ZTIM:"ZTIMEOUT",ZT:"ZTRAP",ZV:"ZVERSION",ZYER:"ZYERROR",ZYRE:"ZYRELEASE",ZTDE:"ZTDELIM"},I={BREAK:{abbreviation:"B",postcondition:!0,parameter:"[expr[:tvexpr][,...]]"},CLOSE:{abbreviation:"C",postcondition:!0,parameter:"expr[:(keyword[=expr][:...])][,...]"},DO:{abbreviation:"D",postcondition:!0,parameter:"[entryref[(expr:.lvn[,...])][:tvexpr][,...]]"},ELSE:{abbreviation:"E",postcondition:!1,parameter:""},FOR:{abbreviation:"F",postcondition:!1,parameter:"[lvn=expr[:numexpr1[:numexpr2]][,...]]]"},GOTO:{abbreviation:"G",postcondition:!0,parameter:"entryref[:tvexpr][,...]"},HALT:{abbreviation:"H",postcondition:!0,parameter:""},HANG:{abbreviation:"H",postcondition:!0,parameter:"numexpr[,...]"},IF:{abbreviation:"I",postcondition:!1,parameter:"[tvexpr[,...]]"},JOB:{abbreviation:"J",postcondition:!0,parameter:"entryref[(expr[,...])][:[(keyword[=value][:...])][:numexpr]][,...]"},KILL:{abbreviation:"K",postcondition:!0,parameter:"[glvn | (lvn[,...]) | *lname | *lvn ]"},LOCK:{abbreviation:"L",postcondition:!0,parameter:"[[-|+]nref|(nref[,...])[:numexpr] [,...]]"},MERGE:{abbreviation:"M",postcondition:!0,parameter:"glvn=glvn[,...]"},NEW:{abbreviation:"N",postcondition:!0,parameter:"[[(]lvn[,...][)][,...]]"},OPEN:{abbreviation:"O",postcondition:!0,parameter:"expr[:[(keyword[=expr][:...])] [:numexpr]][,...]"},QUIT:{abbreviation:"Q",postcondition:!0,parameter:"[expr | *lname | *lvn]"},READ:{abbreviation:"R",postcondition:!0,parameter:"(glvn|*glvn|glvn#intexpr)[:numexpr]|strlit|fcc[,...]"},SET:{abbreviation:"S",postcondition:!0,parameter:"setleft=expr | (setleft[,...])=expr | *lvn=lname | aliascontainer[,...]"},TCOMMIT:{abbreviation:"TC",postcondition:!0,parameter:""},TRESTART:{abbreviation:"TRE",postcondition:!0,parameter:""},TROLLBACK:{abbreviation:"TRO",postcondition:!0,parameter:"[intexpr]"},TSTART:{abbreviation:"TS",postcondition:!0,parameter:"[([lvn...])|lvn|*|][:keyword|(keyword...)]"},USE:{abbreviation:"U",postcondition:!0,parameter:"expr[:(keyword[=expr][:...])][,...]"},VIEW:{abbreviation:"V",postcondition:!0,parameter:"keyword[:expr[:...]][,...]"},WRITE:{abbreviation:"W",postcondition:!0,parameter:"expr|*intexpr|fcc[,...]"},XECUTE:{abbreviation:"X",postcondition:!0,parameter:"expr[:tvexpr][,...]"},ZALLOCATE:{abbreviation:"ZA",postcondition:!0,parameter:"[(]nref[,...][)][:intexpr][,...]"},ZBREAK:{abbreviation:"ZB",postcondition:!0,parameter:"[-]entryref[:[expr][:intexpr]][,...]"},ZCOMPILE:{abbreviation:"ZCOM",postcondition:!0,parameter:"expr[,...]"},ZCONTINUE:{abbreviation:"ZC",postcondition:!0,parameter:""},ZDEALLOCATE:{abbreviation:"ZD",postcondition:!0,parameter:"[nref[,...]]"},ZEDIT:{abbreviation:"ZED",postcondition:!0,parameter:"[expr[,...]]"},ZGOTO:{abbreviation:"ZG",postcondition:!0,parameter:"[[intexpr][:entryref[:tvexpr]],...]"},ZHALT:{abbreviation:"ZHALT",postcondition:!0,parameter:"[intexpr]"},ZHELP:{abbreviation:"ZH",postcondition:!0,parameter:"[expr1[:expr2],...]"},ZKILL:{abbreviation:"ZK",postcondition:!0,parameter:"glvn"},ZLINK:{abbreviation:"ZL",postcondition:!0,parameter:"[expr1[:expr2][,...]]"},ZMESSAGE:{abbreviation:"ZM",postcondition:!0,parameter:"intexpr[:expr2][:...]"},ZPRINT:{abbreviation:"ZP",postcondition:!0,parameter:"[entryref[:label[+intexpr]][,...]"},ZRUPDATE:{abbreviation:"ZRUP",postcondition:!0,parameter:"expr[,...]"},ZSHOW:{abbreviation:"ZSH",postcondition:!0,parameter:"[expr[:glvn][,...]]"},ZSTEP:{abbreviation:"ZST",postcondition:!0,parameter:"[keyword[:expr]][,...]"},ZSYSTEM:{abbreviation:"ZSY",postcondition:!0,parameter:"[expr][,...]]"},ZTCOMMIT:{abbreviation:"ZTC",postcondition:!0,parameter:"[intexpr]"},ZTRIGGER:{abbreviation:"ZTR",postcondition:!0,parameter:"gvn"},ZTSTART:{abbreviation:"ZTS",postcondition:!0,parameter:""},ZWITHDRAW:{abbreviation:"ZWI",postcondition:!0,parameter:"glvn"},ZWRITE:{abbreviation:"ZWR",postcondition:!0,parameter:"[zwrglvn[,...]]"}},L={ASCII:{maxparams:2},CHAR:{maxparams:99},DATA:{maxparams:1,format:"glvn"},EXTRACT:{maxparams:3},FIND:{maxparams:3},FNUMBER:{minparams:2,maxparams:3},GET:{maxparams:2,format:"glvn,expr"},INCREMENT:{maxparams:2,format:"glvn,expr"},JUSTIFY:{maxparams:3},LENGTH:{maxparams:2},NAME:{maxparams:2,format:"glvn,expr"},NEXT:{maxparams:1,format:"glvn("},ORDER:{maxparams:2,format:"glvn,expr"},PIECE:{maxparams:4},QLENGTH:{maxparams:1,format:"expr"},QSUBSCRIPT:{maxparams:2,format:"expr,expr"},QUERY:{maxparams:1,format:"glvn"},RANDOM:{maxparams:1},REVERSE:{maxparams:1},SELECT:{maxparams:99,format:"special"},STACK:{maxparams:2},TEXT:{maxparams:1,format:"entryref"},TRANSLATE:{maxparams:3},VIEW:{maxparams:2},ZASCII:{maxparams:2},ZATRANSFORM:{minparams:2,maxparams:4,format:"expr,expr,bool,bool"},ZBITAND:{minparams:2,maxparams:2},ZBITCOUNT:{maxparams:1},ZBITFIND:{maxparams:3},ZBITGET:{minparams:2,maxparams:2},ZBITLEN:{maxparams:1},ZBITNOT:{maxparams:1},ZBITOR:{minparams:2,maxparams:2},ZBITSET:{minparams:3,maxparams:3},ZBITSTR:{maxparams:2},ZBITXOR:{minparams:2,maxparams:2},ZCHAR:{maxparams:99},ZCOLLATE:{maxparams:3,format:"glvn,expr,bool"},ZCONVERT:{maxparams:3},ZDATA:{maxparams:1,format:"lvn"},ZDATE:{maxparams:4},ZEXTRACT:{maxparams:3},ZFIND:{maxparams:3},ZGETJPI:{minparams:2,maxparams:2},ZJOBEXAM:{minparams:0,maxparams:1},ZJUSTIFY:{minparams:2,maxparams:3},ZLENGTH:{maxparams:2},ZMESSAGE:{maxparams:1},ZPARSE:{maxparams:5},ZPEEK:{maxparams:4},ZPIECE:{maxparams:4},ZPREVIOUS:{maxparams:1,format:"glvn"},ZQGBLMOD:{maxparams:1,format:"gvn"},ZSEARCH:{maxparams:2},ZSIGPROC:{maxparams:2},ZSOCKET:{minparams:2,maxparams:4},ZSUBSTR:{minparams:2,maxparams:3},ZSYSLOG:{maxparams:1},ZTRANSLATE:{maxparams:3},ZTRIGGER:{maxparams:2},ZTRNLNM:{maxparams:6},ZWIDTH:{maxparams:1},ZWRITE:{maxparams:2}};t.MumpsLineParser=class{constructor(){this._tokens=[],this.linePosition=0}checkFile(e){const t=[];let n;try{n=i.readFileSync(e,"utf8")}catch(n){return t.push({text:"File read error: "+e,position:0,line:0}),t}const s=n.split("\n");for(let e=0;e<s.length;e++){s[e]=s[e].replace(/\r/g,"");const n=this.checkLine(s[e]);""!==n.text&&(n.line=e+1,t.push(n))}return t}checkLine(e){this._tokens=[],this.linePosition=0;const t=this._parseLine(e);if(t.lineLabel&&this._splitLabelAndParameters(t.lineLabel),t.lineIndentationArray){let e=0;t.lineLeadSpace&&(e+=t.lineLeadSpace.length),t.lineLabel&&(e+=t.lineLabel.length),this._tokens.push({name:".".repeat(t.lineIndentationArray.length),type:s.intendation,position:e})}t.lineComment&&this._tokens.push({name:t.lineComment.comment,position:t.lineComment.position,type:s.comment});let n={text:"",position:0};if(t.lineRoutines)for(let i=0;i<t.lineRoutines.length;i++){const o=t.lineRoutines[i];if(o.mCommand.length>0){let t=o.mCommand.toUpperCase();if("H"===t&&(t=""===o.mArguments?"HALT":"HANG"),!t.match(g))return{text:"Invalid Command",position:o.cmdPosition};{let i=t;if(void 0===I[t]&&(i=S[t]),this._tokens.push({name:o.mCommand,type:s.keyword,position:o.cmdPosition,longName:i,isPostconditioned:""!==o.mPostCondition,hasArguments:""!==o.mArguments}),void 0===i)return n.text="Unknown Command",n.position=o.cmdPosition,n;try{n=this._checkCommand(e,i,o)}catch(n){return n}}}}return n}analyzeLine(e){return this._tokens=[],e=e.replace(/\r/g,""),{error:this.checkLine(e),tokens:this._tokens}}analyzeLines(e){const t=e.split("\n"),n=[];for(let e=0;e<t.length;e++)t[e]=t[e].replace(/\r/g,""),this.checkLine(t[e]),n[e]=this._tokens;return n}expandCompressFile(e,t){let n;void 0===t&&(t=!1);let s=[];try{n=i.readFileSync(e,"utf8")}catch(e){return s[0]="File read error: ",s[0]}s=n.split("\n");for(let e=0;e<s.length;e++){const n=this.expandCompressLine(s[e],t);if(""!==n.errorText){s=[],s[0]="Error in Line "+e+" : "+n.errorText;break}s[e]=n.lineText}return s.join("\n")}expandCompressLine(e,t){e=e.replace(/\r/g,""),!1===t&&void 0===this.cmdCompressions&&(this.cmdCompressions={},Object.keys(S).forEach((e=>{this.cmdCompressions[S[e]]=e})),this.funcCompressions={},Object.keys(A).forEach((e=>{this.funcCompressions[A[e]]=e})),this.isvCompressions={},Object.keys(Z).forEach((e=>{this.isvCompressions[Z[e]]=e})));const n={lineText:e,errorText:""},i=this.checkLine(e);let o=e;if(""!==i.text)n.errorText=i.text;else{let e=0;for(let n=0;n<this._tokens.length;n++){const i=this._tokens[n];if(i.hasOwnProperty("longName")){const n=i.name;let r=n;const a=i.position;if(t)r=i.longName.toLowerCase(),r="$"===r[0]?"$"+r[1].toUpperCase()+r.substring(2):r[0].toUpperCase()+r.substring(1);else{let e=n.toUpperCase();"$"===n[0]&&(e=n.substring(1)),i.type===s.keyword?void 0!==this.cmdCompressions[e]&&(r=this.cmdCompressions[e]):i.type===s.ifunction?void 0!==this.funcCompressions[e]&&(r="$"+this.funcCompressions[e]):i.type===s.sysvariable&&void 0!==this.isvCompressions[e]&&(r="$"+this.isvCompressions[e])}n.length!==r.length&&(o=o.substring(0,e+a)+r+o.substring(e+a+n.length),e+=r.length-n.length)}}}return n.lineText=o,n}getLabels(e){const t=[],n=e.split("\n");for(let e=0;e<n.length;e++){const i=this._parseLine(n[e]);i.lineLabel&&t.push({name:i.lineLabel,line:e})}return t}getTokenAt(e,t){this.checkLine(e);let n=0,i=-1;for(let e=0;e<this._tokens.length;e++){const s=this._tokens[e];s.position>=n&&s.position<t&&(n=s.position,i=e)}if(-1!==i)return this._tokens[i]}_checkEntryRefAndPostcondition(e,t,n){let i={text:"",position:t};return i=this._checkEntryRef(e,i.position,n),":"===e[i.position]&&(this._tokens.push({type:s.argPostcondition,name:":",position:t}),i=this._evaluateExpression(0,e,++i.position)),i}_checkEntryRef(e,t,n,i){void 0===i&&(i=!1);let o=s.entryref;i&&(o=s.exfunction);let r={text:"",position:t};if("@"===e[r.position]){if(r=this._evaluateExpression(4,e,++r.position),"+"===e[r.position]&&(r=this._evaluateExpression(0,e,++r.position)),"^"===e[r.position])if("@"===e[r.position+1])r=this._evaluateExpression(4,e,++r.position);else{if(!e.substring(r.position).match(u))throw r.text="Invalid EntryRef",r;{const t=e.substring(r.position).match(u)[0];r.position+=t.length}}"@("===e.substring(r.position,r.position+2)&&r.position++}else{if(!e.substring(r.position).match(u))throw r.text="Invalid Entryref",r;{let t=e.substring(r.position).match(u)[0];const n=r.position;r.position+=t.length;const i=e[r.position];if(r.position>=e.length){if(t.length>0)return"&"===t[0]&&(o=s.nonMfunction),this._tokens.push({type:o,name:t,position:n+this.linePosition}),r;throw r.text="Missing Entryref",r}if(-1===t.indexOf("^")&&"+"===i){if(r=this._evaluateExpression(0,e,++r.position),r.position>=e.length)return this._tokens.push({type:o,name:t,position:n+this.linePosition}),r;if(e.substring(r.position).match(h)){const n=e.substring(r.position).match(h)[0];t+=n,r.position+=n.length}}this._tokens.push({type:o,name:t,position:n+this.linePosition})}}return"("===e[r.position]&&n&&(r=this._evaluateExpression(2,e,++r.position,1)),r}_checkVar(e,t,n,i,o){let p={text:"",position:t,indexFound:!1,globalFound:!1,indirectionFound:!1},c=!1;if(void 0===n&&(n=!0),void 0===i&&(i=!0),void 0===o&&(o=!1),"@"===e[p.position])p=this._evaluateExpression(4,e,++p.position),p.indirectionFound=!0,c=!0,"@("===e.substring(p.position,p.position+2)&&p.position++;else if(e.substring(p.position).match(a)||"^|"===e.substring(p.position,p.position+2)){if(!n)throw p.text="Global not allowed here",p;if(p.globalFound=!0,"^|"===e.substring(p.position,p.position+2)){if(p.position+=2,p=this._evaluateExpression(0,e,p.position),p.globalFound=!0,","===e[p.position]&&(p=this._evaluateExpression(0,e,++p.position),p.globalFound=!0),"|"!==e[p.position])throw p.text='Missing "|"',p;if(p.position++,e.substring(p.position).match(r)){const t=e.substring(p.position).match(r)[0];this._tokens.push({name:t,type:s.global,position:p.position+this.linePosition}),c=!0,p.position+=t.length}}else{const t=e.substring(p.position).match(a)[0];this._tokens.push({name:t,type:s.global,position:p.position+this.linePosition}),c=!0,p.position+=t.length}}else if(e.substring(p.position).match(r)){const t=e.substring(p.position).match(r)[0];this._tokens.push({name:t,type:s.local,position:p.position+this.linePosition,isExcludedVariable:o}),c=!0,p.position+=t.length}else if("^("===e.substring(p.position,p.position+2)){if(p.globalFound=!0,!n)throw p.text="Global not allowed here",c=!1,p;c=!0,p.position++}if(c&&"("===e[p.position]){if(!i)throw p.text="Index not allowed here",p;const t=this._evaluateExpression(1,e,++p.position,1);p.position=t.position,p.indexFound=!0}if(!c)throw p.text="Name missing",p;return p}_checkBreak(e,t){let n=this._evaluateExpression(0,e,t);return":"===e[n.position]&&(n=this._evaluateExpression(0,e,++n.position)),n}_checkKeyword(e,t,n){let i={text:"",position:n};if(!t.substring(i.position).match(e))throw i.text="No valid Keyword for command found",i;{const n=t.substring(i.position).match(e)[0];i.position+=n.length,"="===n.slice(-1)&&(i=this._evaluateExpression(0,t,i.position))}return i}_checkOUC(e,t,n){let i={text:"",position:n};if(i=this._evaluateExpression(0,t,i.position),":"===t[i.position])if(i.position++,"("===t[i.position]){i.position++;let n=!1;do{if(i=this._checkKeyword(e,t,i.position),n=!0,")"===t[i.position]){i.position++;break}if(":"!==t[i.position])throw i.text="Unecpected Character",i;i.position++,n=!1}while(!this._isEndOfArgument(t,i.position));if(!n)throw i.text='Missing ")" or Keyword',i}else":"!==t[i.position]&&(i=this._checkKeyword(e,t,i.position));return e===T&&":"===t[i.position]&&(i.position++,":"!==t[i.position]&&(i=this._evaluateExpression(0,t,i.position))),e===T&&":"===t[i.position]&&(i=this._evaluateExpression(0,t,++i.position)),i}_checkFor(e,t,n){let i={text:"",position:t};if(n>1)try{const t=this._checkVar(e,i.position,!1);'"'===e[t.position]&&(i.position=t.position+1)}catch(e){if("Name missing"!==e.text)throw i}else{if(i=this._checkVar(e,i.position,!1),"="!==e[i.position])throw i.text="Missing equal-sign",i;i.position++}return i=this._evaluateExpression(0,e,i.position),":"!==e[i.position]||(i=this._evaluateExpression(0,e,++i.position),":"!==e[i.position]||(i=this._evaluateExpression(0,e,++i.position))),i}_checkJobKeyword(e,t){const n={text:"",position:t};if(!e.substring(n.position).match(_))throw n.text="No valid Keyword for JOB Command",n;{const t=e.substring(n.position).match(_)[0];if(n.position+=t.length,"="===t[t.length-1]){if(!e.substring(n.position).match(m))throw n.text="String literal expected",n;{const t=e.substring(n.position).match(m)[0];if(n.position+=t.length,0===t.length)throw n.text="String literal expected",n}}}return n}_checkJob(e,t){let n=this._checkEntryRef(e,t,!0);if(":"===e[n.position])if(n.position++,"("===e[n.position]){n.position++;let t=!1;do{if(n=this._checkJobKeyword(e,n.position),t=!0,")"===e[n.position]){n.position++;break}if(":"!==e[n.position])throw n.text="Unecpected Character",n;n.position++,t=!1}while(!this._isEndOfArgument(e,n.position));if(!t)throw n.text='Missing ")" or Keyword',n}else":"!==e[n.position]&&(n=this._checkJobKeyword(e,n.position));return":"===e[n.position]&&(n=this._evaluateExpression(0,e,++n.position)),n}_checkKill(e,t){let n={text:"",position:t};if("("===e[n.position]){n.position++;let t=!1;do{if(n=this._checkVar(e,n.position),t=!0,")"===e[n.position]){n.position++;break}if(","!==e[n.position])throw n.text="Unecpected Character",n;n.position++,t=!1}while(!this._isEndOfArgument(e,n.position));if(!t)throw n.text='Missing ")" or Name',n}else n=this._checkVar(e,n.position);return n}_checkLock(e,t,n){let i={text:"",position:t};if("+"!==e[i.position]&&"-"!==e[i.position]||!n||i.position++,"("===e[i.position]){i.position++;let t=!1;do{if(i=this._checkVar(e,i.position),t=!0,")"===e[i.position]){i.position++;break}if(","!==e[i.position])throw i.text="Unecpected Character",i;i.position++,t=!1}while(!this._isEndOfArgument(e,i.position));if(!t)throw i.text='Missing ")" or Name',i}else i=this._checkVar(e,i.position);return":"===e[i.position]&&(i=this._evaluateExpression(0,e,++i.position)),i}_checkMerge(e,t){let n={text:"",position:t};if(n=this._checkVar(e,n.position),"="!==e[n.position])throw n.text="Equal-Sign expected",n;return n=this._checkVar(e,++n.position),n}_checkNew(e,t){let n={text:"",position:t};if("("===e[n.position]){n.position++;let i=!1;do{if(e.substring(n.position).match(p)){const i=e.substring(n.position).match(p)[0];let o=i.toUpperCase();void 0!==Z[o.substring(1)]&&(o="$"+Z[o.substring(1)]),this._tokens.push({name:i,position:t+this.linePosition,type:s.sysvariable,longName:o,isExcludedVariable:!0}),n.position+=i.length}else n=this._checkVar(e,n.position,!1,!1,!0);if(i=!0,")"===e[n.position]){n.position++;break}if(","!==e[n.position])throw n.text="Unecpected Character",n;n.position++,i=!1}while(!this._isEndOfArgument(e,n.position));if(!i)throw n.text='Missing ")" or Name',n}else if(e.substring(n.position).match(p)){const i=e.substring(n.position).match(p)[0];let o=i.toUpperCase();void 0!==Z[o.substring(1)]&&(o="$"+Z[o.substring(1)]),this._tokens.push({name:i,position:t+this.linePosition,type:s.sysvariable,longName:o,isExcludedVariable:!1}),n.position+=i.length}else n=this._checkVar(e,n.position,!1);return n}_checkRead(e,t){let n,i={text:"",position:t},s=!1;"*"===e[i.position]&&(i.position++,s=!0);try{const t=this._checkVar(e,i.position);return i.position=t.position,"#"===e[i.position]&&(i=this._evaluateExpression(0,e,++i.position),""!==i.text)||":"===e[i.position]&&(i=this._evaluateExpression(0,e,++i.position)),i}catch(t){if(s)throw i.text="Variable expected",i;if(n=e.substring(i.position).match(m))return i.position+=n[0].length,i;if((n=e.substring(i.position).match(/^(#|!)+/))&&(i.position+=n[0].length),"?"===e[i.position])return i=this._evaluateExpression(0,e,++i.position),i}return i}_checkSet(e,t){let n,i={text:"",position:t},o=!1;if("*"===e[i.position]){if(i=this._checkVar(e,++i.position,!1),"="!==e[i.position])throw i.text="Equal-Sign expected",i;const t=++i.position;try{i=this._checkVar(e,i.position,!1)}catch(n){"$"!==e[t]?i.text="Local Variable or Aliascontainer expected":i=this._evaluateExpression(0,e,t)}return i}"("===e[i.position]&&(o=!0,i.position++);do{if("@"===e[i.position])try{const t=this._checkVar(e,i.position);if(i.position=t.position,this._isEndOfArgument(e,i.position)||","===e[i.position])return i}catch(t){if(i=this._evaluateExpression(4,e,++i.position),this._isEndOfArgument(e,i.position)||","===e[i.position])return i}else if(n=e.substring(i.position).match(/^\$Z?(PIECE|P|EXTRACT|E)\(/i)){let t=n[0].substring(1,n[0].length-1).toUpperCase();i.position+=t.length+2,void 0!==A[t]&&(this._tokens.push({name:"$"+t,position:i.position-t.length-2,type:s.ifunction,longName:"$"+A[t]}),t=A[t]),i=this._checkFunction(t,e,i.position)}else(n=e.substring(i.position).match(p))?i.position+=n[0].length:i=this._checkVar(e,i.position,!0);","===e[i.position]&&o?i.position++:")"===e[i.position]&&o&&(o=!1,i.position++)}while(!this._isEndOfArgument(e,i.position)&&o);if("="!==e[i.position])throw i.text="Equal-Sign expected",i;return i=this._evaluateExpression(0,e,++i.position),i}_checkTstart(e,t){let n={text:"",position:t};if("("===e[n.position]){if(n.position++,")"!==e[n.position]){let t=!1;do{if(t=!0,n=this._checkVar(e,n.position,!1,!1),")"===e[n.position]){n.position++;break}if(","!==e[n.position])throw n.text="Unecpected Character",n;n.position++,t=!1}while(!this._isEndOfArgument(e,n.position));if(!t)throw n.text='Missing ")" or Name',n}}else"*"===e[n.position]?n.position++:n=this._checkVar(e,n.position,!1,!1);if(":"===e[n.position])if(n.position++,"("===e[n.position]){n.position++;let t=!1;do{if(n=this._checkKeyword(x,e,n.position),t=!0,")"===e[n.position]){n.position++;break}if(":"!==e[n.position])throw n.text="Unecpected Character",n;n.position++,t=!1}while(n.position<e.length);if(!t)throw n.text='Missing ")" or Keyword',n}else n=this._checkKeyword(x,e,n.position);return n}_checkView(e,t){let n={text:"",position:t};for(n=this._evaluateExpression(0,e,n.position);":"===e[n.position];)n=this._evaluateExpression(0,e,++n.position);return n}_checkWrite(e,t){let n,i={text:"",position:t};return"*"===e[i.position]?(i=this._evaluateExpression(0,e,++i.position),i):e.substring(i.position).match(/^\/(EOF|PASS|ACCEPT|LISTEN|L|TLS|WAIT|W)/i)?(i=this._checkWriteSocket(e,i.position),i):(n=e.substring(i.position).match(/^(#|!)+/))?(i.position+=n[0].length,"?"===e[i.position]&&(i=this._evaluateExpression(0,e,++i.position)),i):"?"===e[i.position]?(i=this._evaluateExpression(0,e,++i.position),i):(i=this._evaluateExpression(0,e,i.position),i)}_checkWriteSocket(e,t){let n,i={text:"",position:t};if(n=e.substring(i.position).match(/^\/(EOF|PASS|ACCEPT|LISTEN|L|TLS|WAIT|W)/i)){i.position+=n[0].length;const t=n[0].toUpperCase();if("/EOF"===t)return i;if("("!==e[i.position]){if(!t.match(/^\/(LISTEN|L|WAIT|W)/))throw i.text=t+" needs Parameter(s)",i;return i}i.position++;let s=99;"/LISTEN"===t||"/L"===t||"/WAIT"===t||"/W"===t?s=1:"/TLS"===t&&(s=4);let o=0,r=!1;do{if(o++,o>s)throw i.text="More Parameters than expected",i;if("/ACCEPT"===t&&1===o){if("."!==e[i.position])throw i.text="Local Variablereference expected (.lvn)",i;i=this._checkVar(e,++i.position,!1,!1)}else i=this._evaluateExpression(0,e,i.position);if(r=!0,","!==e[i.position]){if(")"===e[i.position]){i.position++;break}}else r=!1}while(!this._isEndOfArgument(e,i.position));if(!r)throw i.text='Missing Parameter or ")"',i}return i}_checkXecute(e,t){let n={text:"",position:t};return n=this._evaluateExpression(0,e,n.position),":"===e[n.position]&&(n=this._evaluateExpression(0,e,++n.position)),n}_checkZbreak(e,t){let n={text:"",position:t};return"-"===e[n.position]&&(n.position++,"*"===e[n.position])?(n.position++,n):(n=this._checkEntryRef(e,n.position,!1),":"===e[n.position]&&(n.position++,":"===e[n.position]?n=this._evaluateExpression(0,e,++n.position):(n=this._evaluateExpression(0,e,++n.position),":"===e[n.position]&&(n=this._evaluateExpression(0,e,++n.position)))),n)}_checkZprint(e,t){let n={text:"",position:t};return n=this._checkEntryRef(e,n.position,!1),":"===e[n.position]&&(n=this._checkEntryRef(e,++n.position,!1)),n}_checkZstep(e,t){let n,i={text:"",position:t};if(!(n=e.substring(i.position).match(/^(INTO|OUTOF|OU|OVER|OV)/i)))throw i.text="Invalid ZSTEP Qualifier",i;return i.position+=n[0].length,":"===e[i.position]&&(i=this._evaluateExpression(0,e,++i.position)),i}_checkCommand(e,t,n){const i=I[t];let s=n.pcPosition;const o=i.postcondition,r=i.parameter;let a={text:"",position:0};if(!o&&""!==n.mPostCondition)throw{text:"Poscondition not allowed",position:s};if(""!==n.mPostCondition&&(a=this._evaluateExpression(0,e,s)),s=n.argPosition,""===n.mArguments){if(""===r||"["===r[0])return{text:"",position:s};throw{text:"Argument for command "+n.mCommand+" required",position:s}}a.position=s;let p=0;do{switch(p++,t){case"BREAK":a=this._checkBreak(e,a.position);break;case"CLOSE":a=this._checkOUC(R,e,a.position);break;case"DO":a=this._checkEntryRefAndPostcondition(e,a.position,!0);break;case"ELSE":if(""!==e)throw{text:"No Argument expected",position:s};break;case"FOR":a=this._checkFor(e,a.position,p);break;case"GOTO":a=this._checkEntryRefAndPostcondition(e,a.position,!1);break;case"HANG":case"IF":case"ZCOMPILE":case"ZEDIT":case"ZHALT":case"ZRUPDATE":case"ZSYSTEM":case"ZTCOMMIT":a=this._evaluateExpression(0,e,a.position);break;case"JOB":a=this._checkJob(e,a.position);break;case"KILL":a=this._checkKill(e,a.position);break;case"LOCK":a=this._checkLock(e,a.position,!0);break;case"MERGE":a=this._checkMerge(e,a.position);break;case"NEW":a=this._checkNew(e,a.position);break;case"OPEN":a=this._checkOUC(T,e,a.position);break;case"QUIT":if(p>1)throw a.text="Quit allows only one Argument",a;a="*"===e[a.position]?this._checkVar(e,++a.position,!1):this._evaluateExpression(0,e,a.position);break;case"READ":a=this._checkRead(e,a.position);break;case"SET":a=this._checkSet(e,a.position);break;case"TROLLBACK":p>1?a.text="TROLLBACK allows only one Argument":a=this._evaluateExpression(0,e,a.position);break;case"TSTART":a=this._checkTstart(e,a.position);break;case"USE":a=this._checkOUC(y,e,a.position);break;case"VIEW":a=this._checkView(e,a.position);break;case"WRITE":a=this._checkWrite(e,a.position);break;case"XECUTE":a=this._checkXecute(e,a.position);break;case"ZALLOCATE":a=this._checkLock(e,a.position,!1);break;case"ZBREAK":a=this._checkZbreak(e,a.position);break;case"ZDEALLOCATE":case"ZKILL":case"ZWITHDRAW":a=this._checkVar(e,a.position);break;case"ZGOTO":a=this._evaluateExpression(0,e,a.position),":"===e[a.position]&&(a=this._checkEntryRefAndPostcondition(e,++a.position,!1));break;case"ZHELP":case"ZLINK":a=this._evaluateExpression(0,e,a.position),":"===e[a.position]&&(a=this._evaluateExpression(0,e,++a.position));break;case"ZMESSAGE":for(a=this._evaluateExpression(0,e,a.position);":"===e[a.position];)a=this._evaluateExpression(0,e,++a.position);break;case"ZPRINT":a=this._checkZprint(e,a.position);break;case"ZSHOW":a=this._evaluateExpression(0,e,a.position),":"===e[a.position]&&(a=this._checkVar(e,++a.position));break;case"ZSTEP":a=this._checkZstep(e,a.position);break;case"ZTRIGGER":if(a=this._checkVar(e,a.position,!0,!1),!a.globalFound)throw a.text="Global Variable expected",a;break;case"ZWRITE":a.position+=e.length;break;default:a.position=e.length}if(","!==e[a.position]){if(void 0!==e[a.position]){const t=e[a.position];if(" "===t||"\t"===t||";"===t)break;throw a.text='Unexpected Character "'+e[a.position]+'"',a}}else if(a.position++,a.position===e.length&&""!==r&&"["!==r[0])throw{text:"Argument for command "+n.mCommand+" required",position:a.position}}while(a.position<e.length);return a}_checkFunction(e,t,n){let i={text:"",position:n};const s=L[e];if(void 0===s)throw i.text="Unknown Function "+e,i;const o=void 0!==s.minparams?s.minparams:1,r=void 0!==s.format?s.format.split(","):void 0;let a=0;if(e="$"+e,0===o&&")"===t[i.position])return i.position++,i;do{let n=void 0!==r&&void 0!==r[a]?r[a]:"expr";if("$SELECT"===e&&(n="special"),"glvn"===n||"gvn"===n||"glvn("===n||"lvn"===n){if(i=this._checkVar(t,i.position),"glvn("===n&&!i.indexFound&&!i.indirectionFound)throw i.text="Variable with Index expected for "+e,i;if("lvn"===n&&i.globalFound)throw i.text="Local variable expected",i}else if("entryref"===n)i=this._checkEntryRef(t,i.position,!1);else if("expr"===n)i=this._evaluateExpression(0,t,i.position);else if("bool"===n){if("0"!==t[i.position]&&"1"!==t[i.position])throw i.text="0/1 expected",i;i.position++}else if("special"===n&&"$SELECT"===e){if(i=this._evaluateExpression(0,t,i.position),":"!==t[i.position])throw i.text="Missing Expression",i;i.position++,i=this._evaluateExpression(0,t,i.position)}a++;const p=t[i.position];if(","!==p){if(")"===p){if(a<o)throw i.text="Less Arguments for "+e+" than expected",i;i.position++;break}throw i.text="Unxepected character ",i}if(a>s.maxparams)throw i.text="More Arguments for "+e+" than expected",i;i.position++}while(!this._isEndOfArgument(t,i.position));return i}_evaluateExpression(e,t,n,i){let o=!1,a=n;void 0===i&&(i=0);let u="";for(;n<t.length;){let h=t.charAt(n);if("("===h){let s=0;switch(u){case"ifunction":s=3;break;case"exfunction":s=2;break;case"pattern":throw{text:'Unecpected "("',position:n}}const r=this._evaluateExpression(s,t,++n,i+1);if(4===e)return r;o=!0,n=r.position;continue}if(u="",")"===h){if(!o){if(n===a&&2===e)return{text:"",position:++n};throw{text:"Incomplete Expression",position:n}}return i>0&&n++,{text:"",position:n}}if("."===h&&2===e){n++;const e=t.substring(n);if(e.match(r)){const i=e.match(r)[0];if(this._tokens.push({type:s.local,name:i,position:n+this.linePosition}),n+=i.length,h=t.charAt(n),","!==h&&")"!==h)throw{text:"Variablereference must stand alone",position:n};o=!0;continue}}if(","===h){if(!o){if(n===a&&2===e){if(0===i)return{text:"",position:++n};o=!1,a=++n;continue}throw{text:"Incomplete Expression",position:n}}if(0===e||4===e)return{text:"",position:n};o=!1,a=++n;continue}if(o){if(4===e)return{text:"",position:n};if(t.substring(n).match(b)){const e=t.substring(n).match(b)[0];this._tokens.push({name:e,position:n+this.linePosition,type:s.operator}),n+=e.length,o=!1,("?"===e||"'?"===e)&&(n=this._evaluatePattern(t,n).position,o=!0,u="pattern");continue}return{text:"",position:n}}const g=t.substring(n);try{const e=this._checkVar(t,n);o=!0,n=e.position}catch(e){if("$$"===g.substring(0,2))n+=2,o=!0,n=(e=this._checkEntryRef(t,n,!0,!0)).position,o=!0;else if(g.match(l)){const e=g.match(l)[0];this._tokens.push({type:s.nonMfunction,name:e,position:n}),n+=e.length,u="exfunction",o=!0}else if(g.match(c)){const e=g.match(c)[0].substring(1).toUpperCase();n+=e.length+2;let i=e;void 0!==A[e]&&(i=A[e]),this._tokens.push({name:"$"+e,position:n-e.length-2,type:s.ifunction,longName:"$"+i}),n=this._checkFunction(i,t,n).position,u="",o=!0}else if(g.match(p)){const e=g.match(p)[0];let t=e.toUpperCase();void 0!==Z[t.substring(1)]&&(t="$"+Z[t.substring(1)]),this._tokens.push({name:e,position:n+this.linePosition,type:s.sysvariable,longName:t}),n+=e.length,o=!0}else if(g.match(d)&&""!==g.match(d)[0]){const e=g.match(d)[0];this._tokens.push({name:e,type:s.number,position:n+this.linePosition}),n+=e.length,o=!0}else if(g.match(m)){const e=g.match(m)[0];this._tokens.push({name:e,type:s.string,position:n+this.linePosition}),n+=e.length,o=!0}else{if(!h.match(f))throw{text:"Unexpected Character "+h,position:n};this._tokens.push({name:h,type:s.operator,position:n+this.linePosition}),n++}}}if(o){if(i>0)throw{text:'Missing ")"',position:n};return{text:"",position:n}}throw{text:"Incomplete Expression",position:n}}_evaluatePattern(e,t,n){let i={text:"",position:t},s=!1;void 0===n&&(n=0);do{if("@"===e[t]){i=this._evaluateExpression(0,e,++t),s=!0;break}if(!e.substring(i.position).match(v)){if(")"===e[i.position]){if(!s)throw i.text="Incomplete pattern",i;return i.position++,i}if(","===e[i.position]&&n>0){if(!s)throw i.text="Incomplete pattern",i;i.position++;continue}break}{const t=e.substring(i.position).match(v)[0];if(""===t){if(")"===e[i.position]){if(!s)throw i.text="Incomplete pattern",i;return n>0&&i.position++,i}if(","===e[i.position]&&n>0){i.position++;continue}break}if(s=!1,i.position+=t.length,e.substring(i.position).match(E)){s=!0,i.position+=e.substring(i.position).match(E)[0].length;continue}if("("===e[i.position]){i=this._evaluatePattern(e,++i.position,n+1),s=!0;continue}}}while(t<e.length);if(!s)throw i.text="Incomplete pattern",i;if(n>0)throw i.text='Missing ")"',i;return i}_extractCommands(e){let t;const n=[],i=this._splitCommandsAndArguments(e);let s=0;for(t={mCommand:"",mPostCondition:"",mArguments:"",cmdPosition:0,argPosition:0,pcPosition:0};s<i.length;){if(s%2==0)t.mCommand=i[s].command,t.cmdPosition=i[s].position;else{t.mArguments=i[s].command,t.argPosition=i[s].position;const e=s+1;for(;e<i.length&&""===i[e].command;)i.splice(e,1);n.push(t),t={mCommand:"",mPostCondition:"",mArguments:"",cmdPosition:0,argPosition:0,pcPosition:0}}s++}i.length%2!=0&&(t.mCommand=i[i.length-1].command,t.cmdPosition=i[i.length-1].position,t.mArguments="",t.argPosition=e.lineExpression.length,n.push(t));const o=this._extractPostConditional(n);return o.length>0&&(e.lineRoutines=o),e}_extractComment(e){const t=e.lineExpression;if(t.search(";")>=0){let n=!1;for(let i=0;i<t.length;i++){if(";"===t[i]&&!n)return e.lineExpression=t.substring(0,i),e.lineComment={comment:t.substring(i).substring(1),position:i+e.expressionPosition},e;'"'===t[i]&&(n=!n)}}return e}_extractIndentation(e){const t=[];let n=0;const i=e.lineExpression;let s="",o=0;for(o=0;o<=i.length;o++){const e=i[o];if("."!==e){if(" "!==e&&"\t"!==e)break;s+=e}else n>0&&t.push(s),n++,s=""}return n>0&&(t.push(s),e.lineExpression=i.substring(o),e.expressionPosition+=o,e.lineIndentationArray=t),e}_extractLabel(e){e.lineLabel="";const t=e.lineExpression;e.lineExpression="",t.match(o)&&(e.lineLabel=t.match(o)[0]);const n=e.lineLabel.length;if(n===t.length)return e;if(!t.charAt(n).match(/[\s|;]/))return e.errorText="Unexpected Character"+t.charAt(n),e.errorPosition=n,e;let i=0;for(i=n;i<=t.length&&(" "===t[i]||"\t"===t[i]);i++);return e.lineLeadSpace=t.substring(n,i),i!==t.length&&(e.lineExpression=t.substring(i),e.expressionPosition=i),e}_extractPostConditional(e){const t=e;for(let e=0;e<t.length;e++){const n=t[e].mCommand.indexOf(":");n>-1&&(t[e].mPostCondition=t[e].mCommand.substring(n+1),t[e].mCommand=t[e].mCommand.substring(0,n),t[e].pcPosition=t[e].cmdPosition+n+1)}return t}_isEndOfArgument(e,t){let n=!1;const i=e[t];return void 0!==i&&" "!==i&&"\t"!==i&&";"!==i||(n=!0),n}_parseLine(e){let t={lineExpression:e,expressionPosition:0};return t=this._extractLabel(t),t.errorText||(t=this._extractComment(t),t=this._extractIndentation(t),t=this._extractCommands(t),t.lineExpression=""),t}_splitCommandsAndArguments(e){const t=[];let n=0,i=!1;const s=e.lineExpression,o=e.expressionPosition;for(let e=0;e<s.length;e++)'"'===s[e]&&(i=!i)," "!==s[e]&&"\t"!==s[e]||i||(s.substring(n,e).length>0?t.push({command:s.substring(n,e),position:o+n}):0!==s.substring(n,e).length||" "!==s.substring(n-1,n)&&"\t"!==s.substring(n-1,n)||t.push({command:s.substring(n,e),position:o+n}),n=e+1);const r=s.length;return s.substring(n,r).length>0?t.push({command:s.substring(n,r),position:o+n}):r!==n||" "!==s.substring(r-1,r)&&"/t"!==s.substring(r-1,r)||t.push({command:"",position:o+n}),t}_splitLabelAndParameters(e){if(-1===e.indexOf("("))this._tokens.push({name:e,position:0,type:s.label});else{const t=e.split("("),n=t[0];this._tokens.push({name:n,position:0,type:s.label});const i=t[1].split(")")[0].split(",");let o=n.length+1;for(let e=0;e<i.length;e++)this._tokens.push({name:i[e],position:o,type:s.local}),o+=i[e].length+1}}}},226:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(496),s=n(105),o=n(147),r=new s.MumpsLineParser;t.default=class{provideReferences(e,t){const n=r.getTokenAt(e.lineAt(t).text,t.character),o=[];if(void 0!==n){let t=n.type;const a=null==n?void 0:n.name;if(t===s.TokenType.label){let n=e.fileName.replace(/\\/g,"/").split("/").pop();n=null==n?void 0:n.split(".")[0].replace("_","%"),t=s.TokenType.entryref;const p=a+"^"+n,c=e.getText().split("\n");for(let t=0;t<c.length;t++)if(c[t].includes(p)||c[t].includes(a)){let n=-1;for(;;){const l=c[t].indexOf(p,n+1);if(-1===l){if(n=c[t].indexOf(a,n+1),-1===n)break}else n=l;const u=r.getTokenAt(c[t],n+1);void 0===u||u.name!==p&&u.name!==a||u.type!==s.TokenType.entryref&&u.type!==s.TokenType.exfunction||o.push(new i.Location(e.uri,new i.Range(t,n,t,n+u.name.length)))}}return this.getallLabelReferences(o,p,t)}return t===s.TokenType.local||t===s.TokenType.global?this.getallLabelReferences(o,a,t):Promise.resolve(o)}return Promise.resolve(o)}getallLabelReferences(e,t,n){return new Promise((a=>{i.workspace.findFiles("*.m").then((p=>{const c=p.length;for(let l=0;l<c;l++){const u=p[l].fsPath;o.readFile(u,"utf8",((o,p)=>{if(!o&&p.includes(t)){const o=p.split("\n");for(let a=0;a<o.length;a++)if(o[a].includes(t)){const p=o[a].indexOf(t),c=r.getTokenAt(o[a],p+1);void 0!==c&&c.name===t&&(c.type===n||c.type===s.TokenType.exfunction&&n===s.TokenType.entryref)&&e.push(new i.Location(i.Uri.file(u),new i.Range(a,p,a,p+c.name.length)))}}l===c-1&&a(e)}))}}))}))}}},293:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(964);t.default=class{provideSignatureHelp(e,t){return new i.MumpsTokenHelper(e,t).getTokenSignature()}}},964:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MumpsTokenHelper=void 0;const i=n(496),s=n(105),o=new s.MumpsLineParser,r=n(776),a={},p=n(147),c=n(17),l=i.Uri,u=[".m",".int",".zwr",".M",".INT",".ZWR"],h={fsPath:"",text:""};function d(e,t){a[e]?a[e].push(t):a[e]=[t]}if(0===Object.keys(a).length)for(const e of r.definitionsArray)d(e.name,e),e.abbreviation&&d(e.abbreviation,e);t.MumpsTokenHelper=class{constructor(e,t){this._document=e,this._position=t}_getText(e){if(e===this._document.uri)return this._document.getText();if(e.fsPath===h.fsPath)return h.text;try{return h.text=p.readFileSync(e.fsPath,"utf8"),h.fsPath=e.fsPath,h.text}catch(e){return""}}getTokenSignature(){const e=this._document.lineAt(this._position);if(!e)return;const t=e.text,n=this._getFunctionToken(t);if(void 0===n||n.type!==s.TokenType.ifunction&&n.type!==s.TokenType.exfunction)return;const o=this.getTokenData(n.name,n.type);if(!o)return;const r=new i.SignatureHelp;return r.signatures=[this.convertDefinition(o)],r.activeSignature=0,r.activeParameter=this._calculateActiveParameter(e.text,n.position+n.name.length,this._position.character),r}getTokenHoverInfo(){const e=o.getTokenAt(this._document.lineAt(this._position).text,this._position.character);if(void 0!==e&&(e.type===s.TokenType.exfunction||e.type===s.TokenType.ifunction||e.type===s.TokenType.entryref||e.type===s.TokenType.keyword)){const t=this.getTokenData(e.name,e.type);if(!t)return;if(t.parameters){t.name+="(";for(let e=0;e<t.parameters.length;e++)0!==e&&(t.name+=","),t.name+=t.parameters[e].name;t.name+=")"}const n={language:"mumps",value:t.name};return new i.Hover([n,t.commentText||t.description])}}_calculateActiveParameter(e,t,n){let i=0,s=0,o=!1;for(let r=t+1;r<n;r++){const t=e.charAt(r);"("!==t||o?")"!==t||o?'"'===t?o=!o:","!==t||0!==s||o||i++:s--:s++}return i}getTokenRefLocation(){const e=o.getTokenAt(this._document.lineAt(this._position).text,this._position.character);if(void 0!==e&&(e.type===s.TokenType.entryref||e.type===s.TokenType.exfunction)){const t=this.getTokenData(e.name,e.type);if(t)return t.location}}getTokenData(e,t){if(t===s.TokenType.ifunction||t===s.TokenType.keyword){const t=a[e.toUpperCase()];if(!t)return;for(const e of t)if("function"===e.type||"command"===e.type)return Object.assign({},e)}else{if(t!==s.TokenType.exfunction&&t!==s.TokenType.entryref)return;{const t=this.getPositionForLabel(e);if(t)return this._extractDefinition(t)}}}convertDefinition(e){const t={name:"",description:"",parameters:[]};if(t.description=e.description,e.parameters){t.name=e.name+"(";for(let n=0;n<e.parameters.length;n++){const s=e.parameters[n];let o=s.optional?"(optional) ":"";o+=s.description||s.name,t.parameters.push(new i.ParameterInformation(s.name,o)),s.optional&&(t.name+="["),t.name+=0===n?"":",",t.name+=s.name+":"+s.type,s.optional&&(t.name+="]")}t.name+=")",e.returns&&(t.name+=":"+e.returns)}const n=new i.SignatureInformation(t.name,t.description);return n.parameters=t.parameters,n}getPositionForLabel(e){let t=this._document.uri,n=e.split("^")[0],s=0,o="";if(void 0!==n.split("+")[1]&&(s=parseInt(e.split("+")[1]),n=n.split("+")[0]),-1!==e.indexOf("^")){let n=e.split("^")[1];"%"===n.charAt(0)&&(n="_"+n.substring(1));let i=c.resolve(this._document.uri.fsPath,"../"+n);for(const e of u){const t=i+e;if(p.existsSync(t)){i=t;break}}t=l.file(i)}const r=this._getText(t).split("\n");let a="",h=0;const d=n.length;for(h=0;h<r.length;h++)if(r[h].substr(0,d)===n&&null!==r[h].substr(d,1).match(/(;|\s|\()/)){o=r[h],a+=r[h]+"\n";for(let e=h-1;e>0&&(0===r[e].length||r[e].match(/^\s*;/));e--)a+=r[e]+"\n";break}if(a.length>0)return a=a.split("\n").reverse().join("\n"),{commentText:a,location:new i.Location(t,new i.Position(h+s,0)),labelLine:o}}_extractDefinition(e){const t={name:"",type:"function",commentText:"",description:"",returns:{type:""},location:e.location},n=e.commentText;t.commentText=n;const i=/^([%A-Z][A-Z0-9]*)(\((,?[%A-Z][A-Z0-9]*)+\))?/i.exec(e.labelLine);if(!i)return;t.name=i[1],n.indexOf(";")&&(t.commentText=n.substring(n.indexOf(";")+1));let s=[];const o={};if(void 0!==i[2]){s=i[2].substring(1,i[2].length-1).split(","),t.parameters=[];for(let e=0;e<s.length;e++)t.parameters.push({name:s[e],type:"any"}),o[s[e]]=t.parameters.length-1}if(""!==n){const e=n.match(/DESCRIPTION:.*/i);null!==e&&(t.description=e[0]);for(const e in o){const i=n.match(new RegExp("\\s"+e+"(\\(.*\\))?:.*","i"));null!==i&&(t.parameters[o[e]].description=i[0])}}return t}_getFunctionToken(e){let t,n=1;for(t=this._position.character-1;t>0&&n>0;t--){const i=e.charAt(t);")"===i?n++:"("===i&&n--}if(!(n>0||t<=0))return o.getTokenAt(e,t)}}},496:e=>{"use strict";e.exports=require("vscode")},361:e=>{"use strict";e.exports=require("events")},147:e=>{"use strict";e.exports=require("fs")},808:e=>{"use strict";e.exports=require("net")},17:e=>{"use strict";e.exports=require("path")},310:e=>{"use strict";e.exports=require("url")}},t={},n=function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}(112);module.exports=n})();
//# sourceMappingURL=extension.js.map